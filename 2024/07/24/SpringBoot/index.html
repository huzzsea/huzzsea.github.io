<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringBoot | huzzsea</title><meta name="author" content="huzzsea"><meta name="copyright" content="huzzsea"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot第一节	SpringBoot快速入门1.1	简介 SpringBoot 简介：SpringBoot 帮我们简单、快速地创建一个独立的、生产级别的 Spring 应用，大多数 SpringBoot 应用只需要编写少量配置即可快速整合 Spring 平台以及第三方技术  SpringBoot 的特性  快速创建独立 Spring 应用 直接嵌入Tomcat、Jetty 或者 Und">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot">
<meta property="og:url" content="http://example.com/2024/07/24/SpringBoot/index.html">
<meta property="og:site_name" content="huzzsea">
<meta property="og:description" content="SpringBoot第一节	SpringBoot快速入门1.1	简介 SpringBoot 简介：SpringBoot 帮我们简单、快速地创建一个独立的、生产级别的 Spring 应用，大多数 SpringBoot 应用只需要编写少量配置即可快速整合 Spring 平台以及第三方技术  SpringBoot 的特性  快速创建独立 Spring 应用 直接嵌入Tomcat、Jetty 或者 Und">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-07-23T16:29:47.000Z">
<meta property="article:modified_time" content="2024-07-23T16:30:01.096Z">
<meta property="article:author" content="huzzsea">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/07/24/SpringBoot/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-24 00:30:01'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="huzzsea"><span class="site-name">huzzsea</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-23T16:29:47.000Z" title="发表于 2024-07-24 00:29:47">2024-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-23T16:30:01.096Z" title="更新于 2024-07-24 00:30:01">2024-07-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="第一节SpringBoot快速入门"><a href="#第一节SpringBoot快速入门" class="headerlink" title="第一节	SpringBoot快速入门"></a>第一节	SpringBoot快速入门</h2><h3 id="1-1简介"><a href="#1-1简介" class="headerlink" title="1.1	简介"></a>1.1	简介</h3><ul>
<li><p><strong>SpringBoot 简介</strong>：<strong>SpringBoot</strong> 帮我们简单、快速地创建一个独立的、生产级别的 <strong>Spring</strong> 应用，大多数 <strong>SpringBoot</strong> 应用只需要编写少量配置即可快速整合 <strong>Spring</strong> 平台以及第三方技术</p>
</li>
<li><p><strong>SpringBoot 的特性</strong></p>
<ul>
<li>快速创建独立 <strong>Spring</strong> 应用</li>
<li>直接嵌入<strong>Tomcat</strong>、<strong>Jetty</strong> 或者 <strong>Undertow</strong>，无需部署 <strong>war</strong> 包</li>
<li>提供可选的 <strong>starter</strong>，简化应用整合</li>
<li>按需自动配置 <strong>Spring</strong> 以及第三方库</li>
<li>提供生产级特性，如监控指标、健康检查、外部化配置等</li>
<li>无代码生成、无 <strong>xml</strong></li>
</ul>
</li>
</ul>
<h3 id="1-2快速体验"><a href="#1-2快速体验" class="headerlink" title="1.2	快速体验"></a>1.2	快速体验</h3><ul>
<li><p><strong>依赖配置</strong></p>
<ul>
<li><p><strong>继承父项目</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;!--所有springboot项目都必须继承--&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加依赖</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--web开发的场景启动器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加插件</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--SpringBoot应用打包插件--&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>源代码编写</strong></p>
<ul>
<li><p><strong>主程序</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>映射类</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello,springboot&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>特性总结</strong></p>
<ul>
<li><strong>简化整合</strong>：导入相关的场景，拥有相关的功能，场景启动器</li>
<li><strong>简化开发</strong>：无需编写任何配置，直接开发业务</li>
<li><strong>简化配置</strong>：集中式管理配置，只需要修改配置文件，配置基本都有默认值</li>
<li><strong>简化部署</strong>：打包为可执行的 <strong>jar</strong> 包，<strong>linux</strong> 服务器上有 <strong>Java</strong> 环境</li>
<li><strong>简化运维</strong>：修改配置、监控、健康检查</li>
</ul>
</li>
<li><p><strong>Spring</strong> <strong>Initializr 创建向导</strong>：一键创建好整个项目结构</p>
</li>
</ul>
<h3 id="1-3应用分析"><a href="#1-3应用分析" class="headerlink" title="1.3	应用分析"></a>1.3	应用分析</h3><ul>
<li><strong>依赖管理机制</strong><ul>
<li>导入<strong>starter-web</strong> 自动导入所有相关依赖</li>
<li>父项目是版本仲裁中心，声明所有常见的 <strong>jar</strong> 包的依赖版本，无需自定义版本号</li>
<li>自定义版本号，可以利用 <strong>Maven</strong> 的就近原则，直接在导入依赖的时候声明版本</li>
<li><strong>boot</strong> 父项目没有管理的第三方的 <strong>jar</strong> 包需要自行声明</li>
</ul>
</li>
<li><strong>自动配置机制</strong><ul>
<li><strong>自动配置组件</strong>：导入场景，容器中就会自动配置好这个场景的核心组件，例如 <strong>Tomcat</strong>、<strong>SpringMVC</strong> 等</li>
<li><strong>默认的包扫描规则</strong>：**@SpringBootApplication** 标注主程序类，<strong>SpringBoot</strong> 只会扫描主程序所在的包及其下面的子包</li>
<li><strong>自定义扫描路径</strong>：使用 **@SpringBootApplication(scanBasePackages &#x3D; “com.example”)**，或者 <strong>@ComponentScan(“com.example”)</strong> 直接指定扫描的路径</li>
<li><strong>配置默认值</strong>：配置文件的所有配置项是和属性类的对象值进行一一绑定</li>
<li><strong>按需加载自动配置</strong>：场景启动器除了会导入相关功能依赖，也会导入一个 <strong>spring-boot-starter</strong>，包含 <strong>spring-boot-autoconfigure</strong> 包，容纳各种场景的<strong>AutoConfiguration</strong> 自动配置类， 导入哪个场景就开启哪个自动配置</li>
</ul>
</li>
<li><strong>自动配置流程细节梳理</strong><ul>
<li><strong>导入 starter-web 场景启动器</strong><ul>
<li>场景启动器导入了相关场景的所有依赖</li>
<li>每个场景启动器都引入了一个 <strong>spring-boot-starter</strong> 核心场景启动器</li>
<li>核心场景启动器引入了 <strong>spring-boot-autoconfigure</strong> 包，里面囊括了所有场景的所有配置</li>
<li><strong>SpringBoot</strong> 默认扫描不到 <strong>spring-boot-autoconfigure</strong> 下写好的所有配置类，只扫描主程序所在的包</li>
</ul>
</li>
<li><strong>主程序 @SpringBootApplication</strong><ul>
<li><strong>@SpringBootApplication</strong> 由 <strong>@SpringBootConfiguration</strong>、**@EnableAutoConfiguration<strong>、</strong>@ComponentScan** 三个注解组成</li>
<li><strong>SpringBoot</strong> 默认只能扫描自己主程序所在的包及其下面的子包，扫描不到 <strong>spring-boot-autoconfigure</strong> 包中官方写好的配置</li>
<li><strong>@EnableAutoConfiguration</strong> 注解是开启自动配置的核心注解</li>
<li><strong>@Import</strong> 注解会批量给容器中导入组件，<strong>SpringBoot</strong> 启动会默认加载来自于 <strong>spring-boot-autoconfigure</strong> 下 <strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 文件的配置类</li>
<li>并不是所有自动配置类都能生效，每一个自动配置类，都有条件注解 <strong>@ConditionalOnxxx</strong>，只有条件成立，才会按需生效</li>
</ul>
</li>
<li><strong>xxxxAutoConfiguration 自动配置类</strong><ul>
<li>使用 <strong>@Bean</strong> 注解向容器中添加组件</li>
<li>每个自动配置类都可能有这个注解 <strong>@EnableConfigurationProperties</strong>，用来把配置文件中配的指定前缀的属性值封装到 <strong>xxxProperties</strong> 属性类中</li>
<li><strong>xxxProperties</strong> 都是和配置文件绑定，只需要改配置文件的值，核心组件的底层参数都能修改</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-4核心技能"><a href="#1-4核心技能" class="headerlink" title="1.4	核心技能"></a>1.4	核心技能</h3><ul>
<li><p><strong>常用注解</strong></p>
<ul>
<li><p><strong>组件注册</strong></p>
<ul>
<li><p><strong>@SpringBootApplication</strong>：用在启动类上，主要组合包含了以下 3 个注解：**@Configuration<strong>，</strong>@EnableAutoConfiguration** 和**@ComponentScan**</p>
</li>
<li><p><strong>@Configuration</strong>：实现配置文件的功能，该类是 <strong>bean</strong> 配置的信息源</p>
</li>
<li><p><strong>@Bean</strong>：标识一个方法，替代以前的 <strong>bean</strong> 标签，产生一个 <strong>bean</strong> 并交给 <strong>spring</strong> 管理</p>
</li>
<li><p><strong>@Scope</strong>：用于指定 <strong>spring</strong> <strong>bean</strong> 的作用域，可以是 <strong>Singleton</strong>、<strong>Prototype</strong>、<strong>Request</strong>、<strong>Session</strong> 等</p>
</li>
<li><p><strong>@Import</strong>：用于引入其他配置类或组件类，可以将其他配置类中的 <strong>bean</strong> 引入到当前配置类中</p>
</li>
<li><p><strong>@ComponentScan</strong>：用于开启组件扫描，用于自动扫描并注册注解类到 <strong>spring</strong> 容器</p>
</li>
</ul>
</li>
<li><p><strong>条件注解</strong></p>
<ul>
<li><strong>@ConditionalOnClass</strong>：如果类路径中存在这个类，则触发指定行为</li>
<li><strong>@ConditionalOnMissingClass</strong>：如果类路径中不存在这个类，则触发指定行为</li>
<li><strong>@ConditionalOnBean</strong>：如果容器中存在这个 <strong>bean</strong>，则触发指定行为</li>
<li><strong>@ConditionalOnMissingBean</strong>：如果容器中不存在这个 <strong>bean</strong>，则触发指定行为</li>
<li><strong>@ConditionalOnBean</strong>：判断容器中是否有这个类型的组件，并且名字是指定的值</li>
</ul>
</li>
<li><p><strong>属性绑定</strong></p>
<ul>
<li><strong>@ConfigurationProperties</strong>： 声明组件的属性和配置文件哪些前缀开始项进行绑定</li>
<li><strong>@EnableConfigurationProperties</strong>：标识于配置类上，将容器中任意组件的属性值和配置文件的配置项的值进行绑定</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>YAML 配置文件</strong></p>
<ul>
<li><p><strong>基本语法</strong></p>
<ul>
<li>大小写敏感</li>
<li>使用缩进表示层级关系，<strong>key: value</strong>，使用空格分割，缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li>
<li>#表示注释，从这个字符一直到行尾，都会被解析器忽略</li>
<li>数组可以使用 <strong>- value</strong> 的方式，也可以使用 <strong>[cat,dog,pig]</strong> 的行内方式</li>
<li>对象可以使用嵌套结构，也可以使用 <strong>{‘name’: ‘Tom Smith’, ‘age’: 37}</strong> 的行内方式</li>
</ul>
</li>
<li><p><strong>语法细节</strong></p>
<ul>
<li><strong>文本</strong>：单引号不会转义字符，双引号会转义字符</li>
<li><strong>大文本</strong>： <strong>|</strong> 开头，大文本写在下层，保留文本格式，换行符正确显示；**&gt;** 开头，大文本写在下层，折叠换行符</li>
<li><strong>多文档合并</strong>：使用 <strong>—</strong> 可以把多个 <strong>yaml</strong> 文档合并在一个文档中，每个文档区依然认为内容独立</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>日志配置</strong></p>
<ul>
<li><p><strong>简介</strong>：<strong>Spring</strong> 使用 <strong>commons-logging</strong> 作为内部日志，但底层日志实现开放，也可以对接其他日志框架</p>
</li>
<li><p><strong>日志配置</strong></p>
<ul>
<li>核心场景引入了日志的所用功能 <strong>spring-boot-starter-logging</strong>，默认使用了 <strong>logback + slf4j</strong> 组合作为默认底层日志</li>
<li>日志使用 <strong>ApplicationListener</strong> 监听器配置，在系统启动后即配置完成</li>
<li>日志所有的配置都可以通过修改配置文件中的以 <strong>logging</strong> 开始的所有配置项完成</li>
</ul>
</li>
<li><p><strong>日志格式</strong></p>
<ul>
<li>时间和日期：毫秒级精度</li>
<li>日志级别：<strong>ERROR</strong>，<strong>WARN</strong>，<strong>INFO</strong>，<strong>DEBUG</strong>，<strong>TRACE</strong></li>
<li>进程 <strong>ID</strong></li>
<li>**—**： 消息分割符</li>
<li>线程名： 使用 <strong>[]</strong> 包含</li>
<li><strong>Logger</strong> 名： 通常是产生日志的类名</li>
<li>消息： 日志记录的内容</li>
</ul>
</li>
<li><p><strong>记录日志</strong>：使用 <strong>getLogger</strong> 方法获取日志信息</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line">longger.info(<span class="string">&quot;hello,logger&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>日志级别</strong></p>
<ul>
<li><strong>ALL</strong>：打印所有日志</li>
<li><strong>TRACE</strong>：追踪框架详细流程日志，一般不使用</li>
<li><strong>DEBUG</strong>：开发调试细节日志</li>
<li><strong>INFO</strong>：关键、感兴趣信息日志，是默认日志级别</li>
<li><strong>WARN</strong>：警告但不是错误的信息日志，比如：版本过时</li>
<li><strong>ERROR</strong>：业务错误日志，比如出现各种异常</li>
<li><strong>FATAL</strong>：致命错误日志，比如jvm系统崩溃</li>
<li><strong>OFF</strong>：关闭所有日志记录</li>
</ul>
</li>
<li><p><strong>日志分组</strong></p>
<ul>
<li><p><strong>自定义分组</strong>：将相关的 <strong>logger</strong> 分组在一起，便于统一管理</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.group.tomcat</span>=<span class="string">org.apache.catalina,org.apache.coyote,org.apache.tomcat</span></span><br><span class="line"><span class="attr">logging.level.tomcat</span>=<span class="string">trace</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>预分组</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#web分组</span></span><br><span class="line"><span class="attr">web</span>=<span class="string">org.springframework.core.codec, org.springframework.http, org.springframework.web, org.springframework.boot.actuate.endpoint.web, org.springframework.boot.web.servlet.ServletContextInitializerBeans</span></span><br><span class="line"><span class="comment">#sql分组</span></span><br><span class="line"><span class="attr">sql</span>=<span class="string">org.springframework.jdbc.core, org.hibernate.SQL, org.jooq.tools.LoggerListener</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>文件输出</strong>：在配置文件中添加 <strong>logging.file.name</strong> 和 <strong>logging.file.path</strong> 配置项</p>
<table>
<thead>
<tr>
<th align="center">logging.file.name</th>
<th align="center">logging.file.path</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">未指定</td>
<td align="center">未指定</td>
<td align="center">仅控制台输出</td>
</tr>
<tr>
<td align="center">指定</td>
<td align="center">未指定</td>
<td align="center">写入指定文件，可以添加路径</td>
</tr>
<tr>
<td align="center">未指定</td>
<td align="center">指定</td>
<td align="center">写入指定目录，例如&#x2F;var&#x2F;log，文件名为 spring.log</td>
</tr>
<tr>
<td align="center">指定</td>
<td align="center">指定</td>
<td align="center">以 logging.file.name 为准</td>
</tr>
</tbody></table>
</li>
<li><p><strong>文件归档与滚动切割</strong></p>
<ul>
<li><p><strong>归档</strong>：每天的日志单独存到一个文档中</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ogging.logback.rollingpolicy.file-name-pattern</span>=<span class="string">$&#123;LOG_FILE&#125;.%d&#123;yyyy-MM-dd&#125;.%i.gz</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>切割</strong>：每个文件限制大小，超过大小切割成另外一个文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.logback.rollingpolicy.max-file-size</span>=<span class="string">1MB</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="第二节SpringBoot-Web开发"><a href="#第二节SpringBoot-Web开发" class="headerlink" title="第二节	SpringBoot-Web开发"></a>第二节	SpringBoot-Web开发</h2><h3 id="2-1WebMvcAutoConfiguration原理"><a href="#2-1WebMvcAutoConfiguration原理" class="headerlink" title="2.1	WebMvcAutoConfiguration原理"></a>2.1	WebMvcAutoConfiguration原理</h3><ul>
<li><p><strong>WebMvcAutoConfiguration 生效条件</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span> <span class="comment">//在这些自动配置之后</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span> <span class="comment">//如果是web应用就生效，类型SERVLET、REACTIVE 响应式web</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span> <span class="comment">//容器中没有这个Bean，才生效。默认就是没有</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><span class="comment">//优先级</span></span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置类效果</strong></p>
<ul>
<li><strong>Filter 类</strong><ul>
<li><strong>HiddenHttpMethodFilter</strong>；页面表单提交 <strong>Rest</strong> 请求（<strong>GET</strong>、<strong>POST</strong>、<strong>PUT</strong>、<strong>DELETE</strong>）</li>
<li><strong>FormContentFilter</strong>： 避免 <strong>PUT</strong>、<strong>DELETE</strong> 请求被服务器忽略</li>
</ul>
</li>
<li><strong>WebMvcConfigurer 组件</strong><ul>
<li>所有的功能最终会和配置文件进行绑定</li>
<li><strong>WebMvcProperties</strong>：绑定 <strong>spring.mvc</strong> 配置文件</li>
<li><strong>WebProperties</strong>：绑定 <strong>spring.web</strong> 配置文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-2Web场景"><a href="#2-2Web场景" class="headerlink" title="2.2	Web场景"></a>2.2	Web场景</h3><ul>
<li><p><strong>配置文件的配置项</strong></p>
<ul>
<li><strong>SpringMVC</strong> 的所有配置以 <strong>spring.mvc</strong> 开头</li>
<li><strong>Web</strong> 场景通用配置以 <strong>spring.web</strong> 开头</li>
<li>文件上传配置以 <strong>spring.servlet.multipart</strong> 开头</li>
<li>服务器的配置以 <strong>server</strong> 开头</li>
</ul>
</li>
<li><p><strong>默认配置</strong></p>
<ul>
<li>包含了 <strong>ContentNegotiatingViewResolver</strong> 和 <strong>BeanNameViewResolver</strong> 组件，方便视图解析</li>
<li>默认的静态资源处理机制： 静态资源放在 <strong>static</strong> 文件夹下即可直接访问</li>
<li>自动注册了 <strong>Converter</strong>，<strong>GenericConverter</strong>，<strong>Formatter</strong> 组件，适配常见数据类型转换和格式化需求</li>
<li>支持 <strong>HttpMessageConverters</strong>，可以方便返回 <strong>json</strong> 等数据类型</li>
<li>注册 <strong>MessageCodesResolver</strong>，方便国际化及错误消息处理</li>
<li>支持静态 <strong>index.html</strong></li>
<li>自动使用 <strong>ConfigurableWebBindingInitializer</strong>，实现消息处理、数据绑定、类型转化、数据校验等功能</li>
</ul>
</li>
</ul>
<h3 id="2-3静态资源"><a href="#2-3静态资源" class="headerlink" title="2.3	静态资源"></a>2.3	静态资源</h3><ul>
<li><p><strong>静态资源默认规则</strong></p>
<ul>
<li><p><strong>静态资源规则映射</strong></p>
<ul>
<li>浏览器访问 <strong>&#x2F;webjars&#x2F;**</strong> 路径服务器去 <strong>classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;</strong> 下找资源</li>
<li>浏览器访问 <strong>&#x2F;**</strong> 路径服务器去静态资源默认的四个位置 <strong>classpath:&#x2F;META-INF&#x2F;resources&#x2F;<strong>，</strong>classpath:&#x2F;resources&#x2F;<strong>，</strong>classpath:&#x2F;static&#x2F;<strong>，</strong>classpath:&#x2F;public&#x2F;</strong> 下找资源</li>
</ul>
</li>
<li><p><strong>静态资源缓存规则设置</strong></p>
<ul>
<li>所有缓存的设置，直接通过配置文件 <strong>spring.web</strong> 进行配置</li>
<li><strong>cachePeriod</strong>：缓存周期</li>
<li><strong>cacheControl</strong>：<strong>HTTP</strong> 缓存控制</li>
<li><strong>useLastModified</strong>：是否使用最后一次修改，配合 <strong>HTTP Cache</strong> 规则</li>
</ul>
</li>
<li><p><strong>页面配置</strong></p>
<ul>
<li>默认页面在静态资源目录下的 <strong>index.html</strong>，如果没有就在 <strong>templates</strong>下找 <strong>index</strong> 模板页</li>
<li>默认图标在静态资源目录下的 <strong>favicon.ico</strong> 文件</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>自定义静态资源默认规则</strong></p>
<ul>
<li><p><strong>配置方式</strong></p>
<ul>
<li><p><strong>spring.web 配置项</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启静态资源映射规则</span></span><br><span class="line"><span class="attr">spring.web.resources.add-mappings</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#设置缓存</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.period</span>=<span class="string">3600</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">7200</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.cachecontrol.cache-public</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#自定义静态资源文件夹位置</span></span><br><span class="line"><span class="attr">spring.web.resources.static-locations</span>=<span class="string">classpath:/a/,classpath:/b/,classpath:/static/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>spring.mvc 配置项</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自定义webjars路径前缀</span></span><br><span class="line"><span class="attr">spring.mvc.webjars-path-pattern</span>=<span class="string">/wj/**</span></span><br><span class="line"><span class="comment">#静态资源访问路径前缀</span></span><br><span class="line"><span class="attr">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>代码方式</strong></p>
<ul>
<li><p><strong>实现 WebMvcConfigurer 接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/a/&quot;</span>,<span class="string">&quot;classpath:/b/&quot;</span>)</span><br><span class="line">                .setCacheControl(CacheControl.maxAge(<span class="number">1180</span>, TimeUnit.SECONDS));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加 WebMvcConfigurer 组件</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">                registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>)</span><br><span class="line">                        .addResourceLocations(<span class="string">&quot;classpath:/a/&quot;</span>, <span class="string">&quot;classpath:/b/&quot;</span>)</span><br><span class="line">                        .setCacheControl(CacheControl.maxAge(<span class="number">1180</span>, TimeUnit.SECONDS));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-4路径匹配"><a href="#2-4路径匹配" class="headerlink" title="2.4	路径匹配"></a>2.4	路径匹配</h3><ul>
<li><p><strong>Ant 风格路径用法</strong></p>
<ul>
<li>*****：表示任意数量的字符</li>
<li>**?**：表示任意一个字符</li>
<li>******：表示任意数量的目录</li>
<li><strong>{}</strong>：表示一个命名模式的占位符</li>
<li>**[]**：表示字符集合</li>
<li><strong>\</strong>：表示特殊字符转义</li>
</ul>
</li>
<li><p><strong>模式切换</strong></p>
<ul>
<li><p><strong>PathPatternParser</strong></p>
<ul>
<li>兼容 <strong>Ant</strong> 风格路径用法，并支持更多类型的路径模式</li>
<li>****** 多段匹配仅支持在模式末尾使用</li>
</ul>
</li>
<li><p><strong>路径匹配规则使用</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/a*/b?/&#123;p1:[a-f]+&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                    <span class="meta">@PathVariable(&quot;p1&quot;)</span> String path)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">    <span class="keyword">return</span> uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>匹配模式切换</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-5内容协商"><a href="#2-5内容协商" class="headerlink" title="2.5	内容协商"></a>2.5	内容协商</h3><ul>
<li><p><strong>多段内容适配</strong></p>
<ul>
<li><p><strong>默认规则</strong></p>
<ul>
<li><strong>基于请求头</strong>：默认开启，客户端向服务端发送请求，携带 <strong>HTTP</strong> 标准的 <strong>Accept</strong> 请求头</li>
<li><strong>基于请求参数</strong>：需要手动开启，根据 <strong>Get</strong> 请求携带的参数匹配，返回不同的数据类型</li>
</ul>
</li>
<li><p><strong>流程演示</strong></p>
<ul>
<li><p><strong>添加依赖</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>标识注解</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JacksonXmlRootElement</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Person <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1L</span>,<span class="string">&quot;Jack&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>开启基于请求参数的内容协商</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.parameter-name</span>=<span class="string">type</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>自定义内容返回</strong></p>
<ul>
<li><p><strong>添加依赖</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>对象类型转换</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1L</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;aaa@qq.com&quot;</span>,<span class="number">18</span>);</span><br><span class="line"><span class="type">YAMLFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLFactory</span>().disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER);</span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(factory);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> mapper.writeValueAsString(person);</span><br><span class="line">System.out.println(s);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写配置</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新增一种媒体类型</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.yaml</span>=<span class="string">text/yaml</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加组件</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">//配置一个能把对象转为yaml的messageConverter</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">            converters.add(<span class="keyword">new</span> <span class="title class_">MyYamlHttpMessageConverter</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-6模板引擎"><a href="#2-6模板引擎" class="headerlink" title="2.6	模板引擎"></a>2.6	模板引擎</h3><ul>
<li><p><strong>基本语法</strong></p>
<ul>
<li><p><strong>th:xxx 属性</strong>：动态渲染指定的 <strong>html</strong> 标签属性值、或者 <strong>th</strong> 指令（遍历、判断等）</p>
</li>
<li><p><strong>表达式</strong></p>
<table>
<thead>
<tr>
<th align="center">表达式</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>${}</strong></td>
<td align="center">变量取值</td>
</tr>
<tr>
<td align="center"><strong>@{}</strong></td>
<td align="center">url路径</td>
</tr>
<tr>
<td align="center"><strong>#{}</strong></td>
<td align="center">国际化消息</td>
</tr>
<tr>
<td align="center"><strong>~{}</strong></td>
<td align="center">片段引用</td>
</tr>
<tr>
<td align="center"><strong>*{}</strong></td>
<td align="center">变量选择</td>
</tr>
</tbody></table>
</li>
<li><p><strong>内置对象</strong></p>
<table>
<thead>
<tr>
<th align="center">对象</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>param</strong></td>
<td align="center">请求参数对象</td>
</tr>
<tr>
<td align="center"><strong>session</strong></td>
<td align="center">session对象</td>
</tr>
<tr>
<td align="center"><strong>application</strong></td>
<td align="center">application对象</td>
</tr>
<tr>
<td align="center"><strong>#dates</strong></td>
<td align="center">日期工具类</td>
</tr>
<tr>
<td align="center"><strong>#strings</strong></td>
<td align="center">字符串操作</td>
</tr>
<tr>
<td align="center"><strong>#arrays</strong></td>
<td align="center">array工具</td>
</tr>
<tr>
<td align="center"><strong>#lists</strong></td>
<td align="center">list工具</td>
</tr>
<tr>
<td align="center"><strong>#sets</strong></td>
<td align="center">set工具</td>
</tr>
<tr>
<td align="center"><strong>#maps</strong></td>
<td align="center">map工具</td>
</tr>
</tbody></table>
</li>
<li><p><strong>属性设置</strong></p>
<ul>
<li><p><strong>th:text</strong>：动态绑定标签内容</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;content&#125;&quot;</span>&gt;</span>原内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:href</strong>：动态绑定链接目标</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:attr</strong>：设置标签的属性</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:each</strong>：遍历集合的内容</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:if</strong>：判断属性值决定是否执行</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;comments.html&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span>&gt;</span>view<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:switch</strong>：多项选择</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>行内写法</strong></p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, [[$&#123;session.user.name&#125;]]!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>模板布局</strong></p>
<ul>
<li><p><strong>th:fragment</strong>：定义模板</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>**~{templatename::selector}**：引用模板</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>th:insert 和 th:replace</strong>：插入模板</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-7国际化"><a href="#2-7国际化" class="headerlink" title="2.7	国际化"></a>2.7	国际化</h3><ul>
<li><p><strong>国际化步骤</strong></p>
<ul>
<li><p><strong>消息文件</strong></p>
<ul>
<li><strong>messages.properties</strong>：默认消息文件</li>
<li><strong>messages_zh_CN.properties</strong>：中文环境消息文件</li>
<li><strong>messages_en_US.properties</strong>：英语环境消息文件</li>
</ul>
</li>
<li><p><strong>获取配置项值</strong></p>
<ul>
<li><p><strong>代码方式</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MessageSource messageSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/haha&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">haha</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> request.getLocale();</span><br><span class="line">    <span class="type">String</span> <span class="variable">login</span> <span class="operator">=</span> messageSource.getMessage(<span class="string">&quot;login&quot;</span>, <span class="literal">null</span>, locale);</span><br><span class="line">    <span class="keyword">return</span> login;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>页面标签方式</strong></p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-8错误处理"><a href="#2-8错误处理" class="headerlink" title="2.8	错误处理"></a>2.8	错误处理</h3><ul>
<li><p><strong>默认机制</strong></p>
<ul>
<li><p>自动配置类 <strong>ErrorMvcAutoConfiguration</strong></p>
</li>
<li><p><strong>SpringBoot</strong> 会自适应处理错误<strong>，</strong>响应页面或 <strong>JSON</strong> 数据</p>
</li>
<li><p><strong>SpringMVC</strong> 的错误处理机制依然保留，<strong>MVC</strong> 处理不了，才会交给 <strong>boot</strong> 进行处理</p>
  <img src="C:\Users\86172\Pictures\Markdown\SpringBoot\错误处理.svg" style="zoom:50%;" /></li>
</ul>
</li>
<li><p><strong>错误处理流程</strong></p>
<ul>
<li><p>发生错误以后，转发给 <strong>&#x2F;error</strong> 路径，<strong>SpringBoot</strong> 在底层写好一个 <strong>BasicErrorController</strong> 的组件，专门处理这个请求</p>
</li>
<li><p>容器中有一个专门的错误视图解析器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(DispatcherServlet.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(ErrorViewResolver.class)</span></span><br><span class="line">DefaultErrorViewResolver <span class="title function_">conventionErrorViewResolver</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultErrorViewResolver</span>(<span class="built_in">this</span>.applicationContext, <span class="built_in">this</span>.resources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析一个错误页规则</p>
</li>
</ul>
<ol>
<li><ul>
<li>如果发生了 <strong>500</strong>、<strong>404</strong>、<strong>503</strong>、<strong>403</strong> 这些错误，如果有模板引擎，默认在  <strong>classpath:&#x2F;templates&#x2F;error&#x2F;精确码.html</strong>，否则在静态资源文件夹下找  <strong>精确码.html</strong>&#96;</li>
<li>如果匹配不到 <strong>精确码.html</strong> 这些精确的错误页，就去找 <strong>5xx.html</strong>，<strong>4xx.html</strong> 模糊匹配，如果有模板引擎，默认 <strong>classpath:&#x2F;templates&#x2F;error&#x2F;5xx.html</strong>，否则在静态资源文件夹下找 <strong>5xx.html</strong></li>
<li>如果模板引擎路径 <strong>templates</strong> 下有 <strong>error.html</strong> 页面，就直接渲染</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>自定义错误响应</strong></p>
<ul>
<li>自定义 <strong>json</strong> 响应：使用 <strong>@ControllerAdvice</strong> + <strong>@ExceptionHandler</strong> 进行统一异常处理</li>
<li>自定义页面响应：根据 <strong>boot</strong> 的错误页面规则，自定义页面模板</li>
</ul>
</li>
</ul>
<h3 id="2-9嵌入式容器"><a href="#2-9嵌入式容器" class="headerlink" title="2.9	嵌入式容器"></a>2.9	嵌入式容器</h3><ul>
<li><p><strong>Servlet 容器</strong>：管理、运行 <strong>Servlet</strong>组件（<strong>Servlet</strong>、<strong>Filter</strong>、<strong>Listener</strong>）的环境，一般指服务器</p>
</li>
<li><p><strong>自动配置原理</strong></p>
<ul>
<li><p><strong>SpringBoot</strong> 默认嵌入<strong>Tomcat</strong> 作为 <strong>Servlet</strong> 容器</p>
</li>
<li><p>自动配置类是 <strong>ServletWebServerFactoryAutoConfiguration</strong>，<strong>EmbeddedWebServerFactoryCustomizerAutoConfiguration</strong></p>
</li>
<li><p><strong>ServletWebServerFactoryAutoConfiguration</strong> 自动配置了嵌入式容器场景，绑定了 <strong>ServerProperties</strong> 配置类，所有和服务器有关的配置</p>
</li>
<li><p><strong>ServletWebServerFactoryAutoConfiguration</strong> 导入了嵌入式的三大服务器 <strong>Tomcat</strong>、<strong>Jetty</strong>、<strong>Undertow</strong></p>
<ul>
<li>导入 <strong>Tomcat</strong> 、<strong>Jetty</strong>、<strong>Undertow</strong> 都具备条件注解</li>
<li>默认 <strong>Tomcat</strong> 配置生效，向容器中添加 <strong>TomcatServletWebServerFactory</strong></li>
<li>都向容器添加  <strong>ServletWebServerFactory</strong> 服务器工厂</li>
<li>服务器工厂具备一个功能，使用 <strong>getWebServer</strong> 获取 <strong>web</strong> 服务器</li>
<li><strong>TomcatServletWebServerFactory</strong> 创建了 <strong>tomcat</strong></li>
</ul>
</li>
<li><p><strong>ServletWebServerApplicationContext</strong> <strong>ioc</strong> 容器，启动的时候会调用来创建 <strong>web</strong> 服务器</p>
</li>
<li><p><strong>Spring</strong> 容器刷新（启动）的时候，会通过 <strong>onRefresh()</strong> 函数预留一个时机来刷新子容器</p>
</li>
<li><p>使用 <strong>refresh()</strong> 来实现容器刷新</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onRefresh();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        createWebServer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextException</span>(<span class="string">&quot;Unable to start web server&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>自定义容器</strong>：通过配置文件来切换服务器</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Exclude the Tomcat dependency --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Use Jetty instead --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-10全面接管SpringMVC"><a href="#2-10全面接管SpringMVC" class="headerlink" title="2.10	全面接管SpringMVC"></a>2.10	全面接管SpringMVC</h3><ul>
<li><p><strong>自动配置规则</strong></p>
<ul>
<li><p>支持 <strong>RESTful</strong> 的 <strong>filter</strong>：<strong>HiddenHttpMethodFilter</strong></p>
</li>
<li><p>支持非 <strong>POST</strong> 请求，请求体携带数据：<strong>FormContentFilter</strong></p>
</li>
<li><p>导入 <strong>EnableWebMvcConfiguration</strong> 组件</p>
<ul>
<li><strong>RequestMappingHandlerAdapter</strong>：请求映射处理</li>
<li><strong>WelcomePageHandlerMapping</strong>： 欢迎页功能支持（模板引擎目录、静态资源目录放 <strong>index.html</strong>），项目访问&#x2F; 就默认展示这个页面.</li>
<li><strong>RequestMappingHandlerMapping</strong>：找每个请求由谁处理的映射关系</li>
<li><strong>ExceptionHandlerExceptionResolver</strong>：默认的异常解析器 </li>
<li><strong>LocaleResolver</strong>：国际化解析器</li>
<li><strong>ThemeResolver</strong>：主题解析器</li>
<li><strong>FlashMapManager</strong>：临时数据共享</li>
<li><strong>FormattingConversionService</strong>： 数据格式化 、类型转化</li>
<li><strong>Validator</strong>： 数据校验 <strong>JSR303</strong> 提供的数据校验功能</li>
<li><strong>WebBindingInitializer</strong>：请求参数的封装与绑定</li>
<li><strong>ContentNegotiationManager</strong>：内容协商管理器</li>
</ul>
</li>
<li><p><strong>WebMvcAutoConfigurationAdapter</strong> 配置生效，它是一个 <strong>WebMvcConfigurer</strong> 组件，用于定义 <strong>mvc</strong> 底层组件</p>
<ul>
<li>定义 <strong>WebMvcConfigurer</strong> 底层组件默认功能</li>
<li><strong>InternalResourceViewResolver</strong>：视图解析器</li>
<li><strong>BeanNameViewResolver</strong>：视图解析器，视图名就是组件名</li>
<li><strong>ContentNegotiatingViewResolver</strong>：内容协商解析器</li>
<li><strong>RequestContextFilter</strong>：请求上下文过滤器，任意位置直接获取当前请求</li>
<li>静态资源链规则</li>
<li><strong>ProblemDetailsExceptionHandler</strong>：错误详情处理器，<strong>SpringMVC</strong> 内部场景异常被它捕获</li>
</ul>
</li>
<li><p>定义了 <strong>MVC</strong> 默认的底层行为 <strong>WebMvcConfigurer</strong></p>
</li>
</ul>
</li>
<li><p><strong>禁用默认行为</strong></p>
<ul>
<li><strong>@EnableWebMvc</strong> 给容器中导入 <strong>DelegatingWebMvcConfiguration</strong> 组件，是 <strong>WebMvcConfigurationSupport</strong></li>
</ul>
<ol start="2">
<li><strong>WebMvcAutoConfiguration</strong> 有一个核心的条件注解，**@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)<strong>，即当容器中没有</strong>WebMvcConfigurationSupport<strong>，</strong>WebMvcAutoConfiguration** 时才生效</li>
<li><strong>@EnableWebMvc</strong> 导入 <strong>WebMvcConfigurationSupport</strong> 导致 <strong>WebMvcAutoConfiguration</strong> 失效，导致禁用了默认行为</li>
</ol>
</li>
<li><p><strong>WebMvcConfigurer 功能</strong></p>
<table>
<thead>
<tr>
<th>提供方法</th>
<th>核心参数</th>
<th>功能</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td><strong>addFormatters</strong></td>
<td>FormatterRegistry</td>
<td><strong>格式化器</strong>：支持属性上@NumberFormat和@DatetimeFormat的数据类型转换</td>
<td>GenericConversionService</td>
</tr>
<tr>
<td><strong>getValidator</strong></td>
<td>无</td>
<td><strong>数据校验</strong>：校验 Controller 上使用@Valid标注的参数合法性。需要导入starter-validator</td>
<td>无</td>
</tr>
<tr>
<td><strong>addInterceptors</strong></td>
<td>InterceptorRegistry</td>
<td><strong>拦截器</strong>：拦截收到的所有请求</td>
<td>无</td>
</tr>
<tr>
<td><strong>configureContentNegotiation</strong></td>
<td>ContentNegotiationConfigurer</td>
<td><strong>内容协商</strong>：支持多种数据格式返回。需要配合支持这种类型的HttpMessageConverter</td>
<td>支持 json</td>
</tr>
<tr>
<td><strong>configureMessageConverters</strong></td>
<td>List&lt;HttpMessageConverter&lt;?&gt;&gt;</td>
<td><strong>消息转换器</strong>：标注@ResponseBody的返回值会利用MessageConverter直接写出去</td>
<td>8 个，支持byte，string,multipart,resource，json</td>
</tr>
<tr>
<td><strong>addViewControllers</strong></td>
<td>ViewControllerRegistry</td>
<td><strong>视图映射</strong>：直接将请求路径与物理视图映射。用于无 java 业务逻辑的直接视图页渲染</td>
<td>无 <a href="mvc:view-controller">mvc:view-controller</a></td>
</tr>
<tr>
<td><strong>configureViewResolvers</strong></td>
<td>ViewResolverRegistry</td>
<td><strong>视图解析器</strong>：逻辑视图转为物理视图</td>
<td>ViewResolverComposite</td>
</tr>
<tr>
<td><strong>addResourceHandlers</strong></td>
<td>ResourceHandlerRegistry</td>
<td><strong>静态资源处理</strong>：静态资源路径映射、缓存控制</td>
<td>ResourceHandlerRegistry</td>
</tr>
<tr>
<td><strong>configureDefaultServletHandling</strong></td>
<td>DefaultServletHandlerConfigurer</td>
<td><strong>默认 Servlet</strong>：可以覆盖 Tomcat 的DefaultServlet。让DispatcherServlet拦截&#x2F;</td>
<td>无</td>
</tr>
<tr>
<td><strong>configurePathMatch</strong></td>
<td>PathMatchConfigurer</td>
<td><strong>路径匹配</strong>：自定义 URL 路径匹配。可以自动为所有路径加上指定前缀，比如 &#x2F;api</td>
<td>无</td>
</tr>
<tr>
<td><strong>configureAsyncSupport</strong></td>
<td>AsyncSupportConfigurer</td>
<td><strong>异步支持</strong>：</td>
<td>TaskExecutionAutoConfiguration</td>
</tr>
<tr>
<td><strong>addCorsMappings</strong></td>
<td>CorsRegistry</td>
<td><strong>跨域</strong>：</td>
<td>无</td>
</tr>
<tr>
<td><strong>addArgumentResolvers</strong></td>
<td>List<HandlerMethodArgumentResolver></td>
<td><strong>参数解析器</strong>：</td>
<td>mvc 默认提供</td>
</tr>
<tr>
<td><strong>addReturnValueHandlers</strong></td>
<td>List<HandlerMethodReturnValueHandler></td>
<td><strong>返回值解析器</strong>：</td>
<td>mvc 默认提供</td>
</tr>
<tr>
<td><strong>configureHandlerExceptionResolvers</strong></td>
<td>List<HandlerExceptionResolver></td>
<td><strong>异常处理器</strong>：</td>
<td>默认 3 个 ExceptionHandlerExceptionResolver ResponseStatusExceptionResolver DefaultHandlerExceptionResolver</td>
</tr>
<tr>
<td><strong>getMessageCodesResolver</strong></td>
<td>无</td>
<td><strong>消息码解析器</strong>：国际化使用</td>
<td>无</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="2-11Web新特性"><a href="#2-11Web新特性" class="headerlink" title="2.11	Web新特性"></a>2.11	Web新特性</h3><ul>
<li><p><strong>Problemdetails</strong></p>
<ul>
<li><p><strong>ProblemDetailsExceptionHandler</strong> 是一个 <strong>@ControllerAdvice</strong> 集中处理系统异常</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.problemdetails&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ProblemDetailsErrorHandlingConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(ResponseEntityExceptionHandler.class)</span></span><br><span class="line">    ProblemDetailsExceptionHandler <span class="title function_">problemDetailsExceptionHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProblemDetailsExceptionHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果系统出现以下异常，会被 <strong>SpringBoot</strong> 支持以 <strong>RFC 7807</strong> 规范方式返回错误数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;</span></span><br><span class="line"><span class="meta">        HttpRequestMethodNotSupportedException.class,</span></span><br><span class="line"><span class="meta">        HttpMediaTypeNotSupportedException.class,</span></span><br><span class="line"><span class="meta">        HttpMediaTypeNotAcceptableException.class,</span></span><br><span class="line"><span class="meta">        MissingPathVariableException.class,</span></span><br><span class="line"><span class="meta">        MissingServletRequestParameterException.class,</span></span><br><span class="line"><span class="meta">        MissingServletRequestPartException.class,</span></span><br><span class="line"><span class="meta">        ServletRequestBindingException.class,</span></span><br><span class="line"><span class="meta">        MethodArgumentNotValidException.class,</span></span><br><span class="line"><span class="meta">        NoHandlerFoundException.class,</span></span><br><span class="line"><span class="meta">        AsyncRequestTimeoutException.class,</span></span><br><span class="line"><span class="meta">        ErrorResponseException.class,</span></span><br><span class="line"><span class="meta">        ConversionNotSupportedException.class,</span></span><br><span class="line"><span class="meta">        TypeMismatchException.class,</span></span><br><span class="line"><span class="meta">        HttpMessageNotReadableException.class,</span></span><br><span class="line"><span class="meta">        HttpMessageNotWritableException.class,</span></span><br><span class="line"><span class="meta">        BindException.class</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>函数式 Web</strong></p>
<ul>
<li><p>构建路由函数</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRoutingConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">RequestPredicate</span> <span class="variable">ACCEPT_JSON</span> <span class="operator">=</span> accept(MediaType.APPLICATION_JSON);</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">routerFunction</span><span class="params">(MyUserHandler userHandler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> route()</span><br><span class="line">                .GET(<span class="string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler::getUser)</span><br><span class="line">                .GET(<span class="string">&quot;/&#123;user&#125;/customers&quot;</span>, ACCEPT_JSON, userHandler::getUserCustomers)</span><br><span class="line">                .DELETE(<span class="string">&quot;/&#123;user&#125;&quot;</span>, ACCEPT_JSON, userHandler::deleteUser)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建对应的处理器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyUserHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getUserCustomers</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">deleteUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第三节SpringBoot数据访问"><a href="#第三节SpringBoot数据访问" class="headerlink" title="第三节	SpringBoot数据访问"></a>第三节	SpringBoot数据访问</h2><ul>
<li><p><strong>数据访问流程</strong></p>
<ul>
<li><p>整合 <strong>ssm</strong> 组件</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据源</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://192.168.200.100:3306/demo</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 <strong>Mybatis</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定mapper映射文件位置</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/*.xml</span></span><br><span class="line"><span class="comment">#参数项调整</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写增删改查语句：编写 <strong>bean</strong> 组件，编写 <strong>Mybatis</strong> 接口，使用 <strong>MybatisX</strong> 插件快速生成 <strong>xml</strong> 文件，测试</p>
</li>
</ul>
</li>
<li><p><strong>自动配置原理</strong></p>
<ul>
<li>自动配置 <strong>jdbc</strong><ul>
<li><strong>mybatis-spring-boot-starter</strong> 导入 <strong>spring-boot-starter-jdbc</strong>，<strong>jdbc</strong> 是操作数据库的场景</li>
<li><strong>Jdbc</strong> 场景的自动配置<ul>
<li><strong>DataSourceAutoConfiguration</strong>：数据源的自动配置，所有和数据源有关的配置都绑定在 <strong>DataSourceProperties</strong>，默认使用 <strong>HikariDataSource</strong></li>
<li><strong>JdbcTemplateAutoConfiguration</strong>：给容器中放了 <strong>JdbcTemplate</strong> 操作数据库</li>
<li><strong>JndiDataSourceAutoConfiguration</strong></li>
<li><strong>XADataSourceAutoConfiguration</strong>：基于 <strong>XA</strong> 二阶提交协议的分布式事务数据源</li>
<li><strong>DataSourceTransactionManagerAutoConfiguration</strong>：支持事务</li>
</ul>
</li>
<li>具有的底层能力：数据源、<strong>JdbcTemplate</strong>、事务</li>
</ul>
</li>
<li>自动配置 <strong>Mybatis</strong><ul>
<li><strong>mybatis-spring-boot-starter</strong> 导入 <strong>mybatis-spring-boot-autoconfigure</strong></li>
<li>默认加载两个自动配置类<ul>
<li><strong>MybatisLanguageDriverAutoConfiguration</strong></li>
<li><strong>MybatisAutoConfiguration</strong></li>
<li>必须在数据源配置好之后才配置，向容器中添加 <strong>SqlSessionFactory</strong> 组件，创建和数据库的一次会话，向容器中添加 <strong>SqlSessionTemplate</strong> 组件，操作数据库</li>
</ul>
</li>
<li><strong>MyBatis</strong> 的所有配置绑定在 <strong>MybatisProperties</strong> 组件中</li>
<li>每个 <strong>Mapper</strong> 接口的代理对象，利用 <strong>@Import(MapperScannerRegistrar.class)</strong> 批量给容器中注册组件，解析指定的包路径里面的每一个类，为每一个 <strong>Mapper</strong> 接口类，创建 <strong>Bean</strong> 定义信息，注册到容器中</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="第四节SpringBoot基础特性"><a href="#第四节SpringBoot基础特性" class="headerlink" title="第四节	SpringBoot基础特性"></a>第四节	SpringBoot基础特性</h2><h3 id="4-1SpringApplication"><a href="#4-1SpringApplication" class="headerlink" title="4.1	SpringApplication"></a>4.1	SpringApplication</h3><ul>
<li><p><strong>自定义 banner</strong>：类路径添加 <strong>banner.txt</strong> 或设置 <strong>spring.banner.location</strong> 就可以定制 <strong>banner</strong></p>
</li>
<li><p><strong>自定义 SpringApplication</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(MyApplication.class);</span><br><span class="line">        application.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">        application.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FluentBuilder API</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>()</span><br><span class="line">    .sources(Parent.class)</span><br><span class="line">    .child(Application.class)</span><br><span class="line">    .bannerMode(Banner.Mode.OFF)</span><br><span class="line">    .run(args);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-2Profiles"><a href="#4-2Profiles" class="headerlink" title="4.2	Profiles"></a>4.2	Profiles</h3><ul>
<li><p><strong>环境隔离</strong>：快速切换开发、测试、生产环境</p>
<ul>
<li><strong>标识环境</strong>：指定哪些组件、配置在哪个环境生效</li>
<li><strong>切换环境</strong>：这个环境对应的所有组件和配置就应该生效</li>
</ul>
</li>
<li><p><strong>配置流程</strong></p>
<ul>
<li><p><strong>指定环境</strong></p>
<ul>
<li><strong>Spring</strong> <strong>Profiles</strong> 提供一种隔离配置的方式，使其仅在特定环境生效</li>
<li>任何 @Component，@Configuration 或 @ConfigurationProperties 可以使用 @Profile 标记，来指定何时被加载</li>
</ul>
</li>
<li><p><strong>环境激活</strong></p>
<ul>
<li><p>配置文件激活</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">production,hsqldb</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>命令行激活</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--spring.profiles.active=dev,hsqldb</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置默认环境</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.default</span>=<span class="string">test</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>环境包含</strong></p>
<ul>
<li><p>添加生效的环境</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.include[0]</span>=<span class="string">common</span></span><br><span class="line"><span class="attr">spring.profiles.include[1]</span>=<span class="string">local</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生效的环境 &#x3D; 激活的环境&#x2F;默认环境  + 包含的环境</p>
</li>
</ul>
</li>
<li><p><strong>Profile 分组</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.group.prod[0]</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">spring.profiles.group.prod[1]</span>=<span class="string">mq</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>配置文件</strong></p>
<ul>
<li><strong>application-{profile}.properties</strong> 可以作为指定环境的配置文件</li>
<li>最终生效的所有配置是<br>  ○ <strong>application.properties</strong>：主配置文件，任意时候都生效，优先级较低<br>○ <strong>application-{profile}.properties</strong>：指定环境配置文件，激活指定环境生效，优先级较高</li>
</ul>
</li>
</ul>
<h3 id="4-3外部化配置"><a href="#4-3外部化配置" class="headerlink" title="4.3	外部化配置"></a>4.3	外部化配置</h3><ul>
<li><p><strong>外部配置</strong>：给 <strong>jar</strong> 应用所在的文件夹放一个 <strong>application.properties</strong> 最新配置文件，重启项目就能自动应用最新配置</p>
</li>
<li><p><strong>配置优先级（由低到高）</strong></p>
<ul>
<li><strong>默认属性</strong>（通过 <strong>SpringApplication.setDefaultProperties</strong> 指定）</li>
<li><strong>@PropertySource</strong> 指定加载的配置（需要写在 <strong>@Configuration</strong> 类上才可生效）</li>
<li>配置文件（ <strong>application.properties&#x2F;yml</strong>等）</li>
<li><strong>RandomValuePropertySource</strong> 支持的 <strong>random.</strong>* 配置</li>
<li><strong>OS</strong> 环境变量</li>
<li><strong>Java</strong> 系统属性（**System.getProperties()**）</li>
<li><strong>JNDI</strong> 属性（来自 <strong>java:comp&#x2F;env</strong>）</li>
<li><strong>ServletContext</strong> 初始化参数</li>
<li><strong>ServletConfig</strong> 初始化参数</li>
<li><strong>SPRING_APPLICATION_JSON</strong> 属性（内置在环境变量或系统属性中的 <strong>JSON</strong>）</li>
<li>命令行参数</li>
<li>测试属性(<strong>@SpringBootTest</strong> 进行测试时指定的属性)</li>
<li>测试类 <strong>@TestPropertySource</strong> 注解</li>
<li><strong>Devtools</strong> 设置的全局属性(<strong>$HOME&#x2F;.config&#x2F;spring-boot</strong>)</li>
</ul>
</li>
<li><p><strong>配置文件优先级（由低到高）</strong></p>
<ul>
<li><strong>jar</strong> 包内的 <strong>application.properties&#x2F;yml</strong></li>
<li><strong>jar</strong> 包内的 <strong>application-{profile}.properties&#x2F;yml</strong></li>
<li><strong>jar</strong> 包外的 <strong>application.properties&#x2F;yml</strong></li>
<li><strong>jar</strong> 包外的 <strong>application-{profile}.properties&#x2F;yml</strong></li>
</ul>
</li>
<li><p><strong>外部配置优先级（由低到高）</strong></p>
<ul>
<li>类根路径</li>
<li>类下 <strong>&#x2F;config</strong> 包</li>
<li>当前路径</li>
<li>当前下 <strong>&#x2F;config</strong> 子目录</li>
<li><strong>&#x2F;config</strong> 目录的直接子目录</li>
</ul>
</li>
<li><p><strong>导入配置</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.config.import</span>=<span class="string">my.properties</span></span><br><span class="line"><span class="attr">my.property</span>=<span class="string">value</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>属性占位符</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app.name</span>=<span class="string">MyApp</span></span><br><span class="line"><span class="attr">app.description</span>=<span class="string">$&#123;app.name&#125; is a Spring Boot application written by $&#123;username:Unknown&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-4单元测试JUnit5"><a href="#4-4单元测试JUnit5" class="headerlink" title="4.4	单元测试JUnit5"></a>4.4	单元测试JUnit5</h3><ul>
<li><p><strong>整合单元测试</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试注解</strong></p>
<ul>
<li><strong>@Test</strong>：表示方法是测试方法，不能声明任何属性，拓展的测试将会由 <strong>Jupiter</strong> 提供额外测试</li>
<li><strong>@ParameterizedTest</strong>：表示方法是参数化测试</li>
<li><strong>@RepeatedTest</strong>：表示方法可重复执行</li>
<li><strong>@DisplayName</strong>：为测试类或者测试方法设置展示名称</li>
<li><strong>@BeforeEach</strong>：表示在每个单元测试之前执行</li>
<li><strong>@AfterEach</strong>：表示在每个单元测试之后执行</li>
<li><strong>@BeforeAll</strong>：表示在所有单元测试之前执行</li>
<li><strong>@AfterAll</strong>：表示在所有单元测试之后执行</li>
<li><strong>@Tag</strong>：表示单元测试类别</li>
<li><strong>@Disabled</strong>：表示测试类或测试方法不执行</li>
<li><strong>@Timeout</strong>：表示测试方法运行如果超过了指定时间将会返回错误</li>
<li><strong>@ExtendWith</strong>：为测试类或测试方法提供扩展类引用</li>
</ul>
</li>
<li><p><strong>测试断言</strong></p>
<ul>
<li><strong>assertEquals</strong>：判断两个对象或两个原始类型是否相等</li>
<li><strong>assertNotEquals</strong>：判断两个对象或两个原始类型是否不相等</li>
<li><strong>assertSame</strong>：判断两个对象引用是否指向同一个对象</li>
<li><strong>assertNotSame</strong>：判断两个对象引用是否指向不同的对象</li>
<li><strong>assertTrue</strong>：判断给定的布尔值是否为 true</li>
<li><strong>assertFalse</strong>：判断给定的布尔值是否为 false</li>
<li><strong>assertNull</strong>：判断给定的对象引用是否为 null</li>
<li><strong>assertNotNull</strong>：判断给定的对象引用是否不为 null</li>
<li><strong>assertArrayEquals</strong>：数组断言</li>
<li><strong>assertAll</strong>：组合断言</li>
<li><strong>assertThrows</strong>：异常断言</li>
<li><strong>assertTimeout</strong>：超时断言</li>
<li><strong>fail</strong>：快速失败</li>
</ul>
</li>
<li><p><strong>嵌套测试</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestingAStackDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>参数化测试</strong></p>
<ul>
<li><p><strong>@ValueSource</strong>：为参数化测试指定入参来源</p>
</li>
<li><p><strong>@NullSource</strong>：表示为参数化测试提供一个 <strong>null</strong> 的入参</p>
</li>
<li><p><strong>@EnumSource</strong>：表示为参数化测试提供一个枚举入参</p>
</li>
<li><p><strong>@CsvFileSource</strong>：表示读取指定 <strong>CSV</strong> 文件内容作为参数化测试入参</p>
</li>
<li><p><strong>@MethodSource</strong>：表示读取指定方法的返回值作为参数化测试入参</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parameterizedTest1</span><span class="params">(String string)</span> &#123;</span><br><span class="line">    System.out.println(string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@MethodSource(&quot;method&quot;)</span>    <span class="comment">//指定方法名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWithExplicitLocalMethodSource</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第五节SpringBoot核心原理"><a href="#第五节SpringBoot核心原理" class="headerlink" title="第五节	SpringBoot核心原理"></a>第五节	SpringBoot核心原理</h2><h3 id="5-1事件和监听器"><a href="#5-1事件和监听器" class="headerlink" title="5.1	事件和监听器"></a>5.1	事件和监听器</h3><ul>
<li><p><strong>监听器 SpringApplicationRunListener</strong></p>
<ul>
<li><p>编写 <strong>SpringApplicationRunListener</strong> 实现类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizedSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <strong>META-INF&#x2F;spring.factories</strong> 中配置 <strong>org.springframework.boot.SpringApplicationRunListener</strong> 为自己的 <strong>Listener</strong>，还可以指定一个有参构造器，接受两个参数 <strong>(SpringApplication application, String[] args)</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.example.listener.CustomizedSpringApplicationRunListener</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>springboot</strong> 在 <strong>spring-boot.jar</strong> 中配置了默认的 <strong>Listener</strong></p>
</li>
</ul>
</li>
<li><p><strong>生命周期全流程</strong></p>
<ul>
<li><strong>引导</strong><ul>
<li><strong>start</strong>：启动</li>
<li><strong>environmentPrepared</strong>：环境准备完成</li>
</ul>
</li>
<li><strong>启动</strong><ul>
<li><strong>contextPrepared</strong>：创建 <strong>ioc</strong>，准备完成，主程序未加载</li>
<li><strong>contextLoaded</strong>：加载 <strong>ioc</strong>，并未刷新</li>
<li><strong>started</strong>：刷新 <strong>ioc</strong>，<strong>return</strong> 未调用</li>
<li><strong>ready</strong>：属性 <strong>ioc</strong>，<strong>return</strong> 调用完成</li>
</ul>
</li>
<li><strong>运行</strong><ul>
<li>**context.isReturn()**：运行中</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>回调监听器</strong></p>
<ul>
<li><p><strong>BootstrapRegistryInitializer</strong>：感知引导初始化</p>
<ul>
<li><p>创建引导上下文 <strong>bootstrapContext</strong> 的时候触发</p>
</li>
<li><p>场景：进行密钥校对授权</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application.addBootstrapRegistryInitializer();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>ApplicationContextInitializer</strong>：感知 <strong>ioc</strong> 容器初始化</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application.addInitializers();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ApplicationListener</strong>：感知全阶段，基于事件机制，感知事件</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication.addListeners()</span><br><span class="line">SpringApplicationBuilder.listeners()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>SpringApplicationRunListener</strong>：感知全阶段生命周期，各种阶段都能自定义操作</p>
</li>
<li><p><strong>ApplicationRunner</strong>：感知应用就绪 <strong>Ready</strong> 阶段</p>
</li>
<li><p><strong>CommandLineRunner</strong>：感知应用就绪 <strong>Ready</strong> 阶段</p>
</li>
</ul>
</li>
<li><p><strong>完整触发流程</strong></p>
<ul>
<li><p><strong>ApplicationStartingEvent</strong>：应用启动但未做任何事情, 除过注册 <strong>listeners</strong> 和 <strong>initializers</strong></p>
</li>
<li><p><strong>ApplicationEnvironmentPreparedEvent</strong>：环境准备完毕，但 <strong>context</strong> 未创建</p>
</li>
<li><p><strong>ApplicationContextInitializedEvent</strong>：<strong>ApplicationContext</strong> 准备完毕，<strong>ApplicationContextInitializers</strong> 调用，但是任何 <strong>bean</strong> 未加载</p>
</li>
<li><p><strong>ApplicationPreparedEvent</strong>： 容器刷新之前，<strong>bean</strong> 定义信息加载</p>
</li>
<li><p><strong>ApplicationStartedEvent</strong>： 容器刷新完成， <strong>runner</strong> 未调用</p>
</li>
<li><p><strong>AvailabilityChangeEvent</strong>： <strong>LivenessState.CORRECT</strong> 应用存活，存活探针</p>
</li>
<li><p><strong>ApplicationReadyEvent</strong>: 任何 <strong>runner</strong> 被调用</p>
</li>
<li><p><strong>AvailabilityChangeEvent</strong>：<strong>ReadinessState.ACCEPTING_TRAFFIC</strong> 就绪探针，可以接受请求</p>
</li>
<li><p><strong>ApplicationFailedEvent</strong> ：启动出错</p>
  <img src="C:\Users\86172\Pictures\Markdown\SpringBoot\流程.png" style="zoom:67%;" /></li>
</ul>
</li>
<li><p><strong>SpringBoot驱动开发</strong></p>
<ul>
<li><p>事件发布</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventPublisher</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventPublisherAware</span> &#123;</span><br><span class="line">    ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEvent</span><span class="params">(ApplicationEvent event)</span> &#123;</span><br><span class="line">        applicationEventPublisher.publishEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>事件监听</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponService</span> &#123;</span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(LoginSuccessEvent loginSuccessEvent)</span>&#123;</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">source</span> <span class="operator">=</span> (UserEntity) loginSuccessEvent.getSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="5-2自动配置原理"><a href="#5-2自动配置原理" class="headerlink" title="5.2	自动配置原理"></a>5.2	自动配置原理</h3><ul>
<li><strong>自动配置流程</strong><ul>
<li>导入 <strong>starter</strong></li>
<li>依赖导入 <strong>autoconfigure</strong></li>
<li>寻找类路径下 <strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 文件</li>
<li>启动并加载所有自动配置类 <strong>xxxAutoConfiguration</strong><ul>
<li>给容器中配置功能组件</li>
<li>组件参数绑定到属性类中，<strong>xxxProperties</strong></li>
<li>属性类和配置文件前缀项绑定</li>
<li><strong>@Contional</strong> 派生的条件注解进行判断是否组件生效</li>
</ul>
</li>
<li>效果<ul>
<li>修改配置文件，修改底层参数</li>
<li>所有场景自动配置好直接使用</li>
<li>可以注入 <strong>SpringBoot</strong> 配置好的组件随时使用</li>
</ul>
</li>
</ul>
</li>
<li><strong>SPI机制</strong><ul>
<li><strong>SPI</strong> 全称 <strong>Service</strong> <strong>Provider</strong> <strong>Interface</strong>，即服务提供者接口，是一种软件设计模式，用于在应用程序中动态地发现和加载组件，<strong>SPI</strong> 的思想是，定义一个接口或抽象类，然后通过在 <strong>classpath</strong> 中定义实现该接口的类来实现对组件的动态发现和加载</li>
<li><strong>SPI</strong> 的主要目的是解决在应用程序中使用可插拔组件的问题，例如一个应用程序可能需要使用不同的日志框架或数据库连接池，但是这些组件的选择可能取决于运行时的条件，通过使用 <strong>SPI</strong>，应用程序可以在运行时发现并加载适当的组件，而无需在代码中硬编码这些组件的实现类</li>
<li>在 <strong>Java</strong> 中，<strong>SPI</strong> 的实现方式是通过在 <strong>META-INF&#x2F;services</strong> 目录下创建一个以服务接口全限定名为名字的文件，文件中包含实现该服务接口的类的全限定名，当应用程序启动时，<strong>Java</strong> 的 <strong>SPI</strong> 机制会自动扫描 <strong>classpath</strong> 中的这些文件，并根据文件中指定的类名来加载实现类</li>
<li>通过使用 <strong>SPI</strong>，应用程序可以实现更灵活、可扩展的架构，同时也可以避免硬编码依赖关系和增加代码的可维护性</li>
<li>在 <strong>SpringBoot</strong> 中，服务接口文件在 <strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 下</li>
</ul>
</li>
<li><strong>@SpringBootApplication注解</strong><ul>
<li><strong>@SpringBootConfiguration</strong>：即 <strong>@Configuration</strong> ，容器中的组件配置类，spring ioc 启动就会加载创建这个类对象</li>
<li><strong>@EnableAutoConfiguration</strong>：开启自动配置</li>
<li><strong>@AutoConfigurationPackage</strong>：扫描主程序包，加载自己的组件</li>
<li>**@Import(AutoConfigurationImportSelector.class)**：加载所有自动配置类，加载 starter 导入的组件</li>
<li><strong>@ComponentScan</strong>：组件扫描，并排除一些组件</li>
</ul>
</li>
</ul>
<h3 id="5-3自定义starter"><a href="#5-3自定义starter" class="headerlink" title="5.3	自定义starter"></a>5.3	自定义starter</h3><ul>
<li><p><strong>自定义starter</strong></p>
<ul>
<li><p>业务代码</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;robot&quot;)</span>  <span class="comment">//此属性类和配置文件指定前缀绑定</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>基本抽取</p>
<ul>
<li>创建 <strong>starter</strong> 项目，把公共代码需要的所有依赖导入</li>
<li>把公共代码复制进来</li>
<li>自己写一个 <strong>RobotAutoConfiguration</strong>，给容器中导入这个场景需要的所有组件</li>
</ul>
</li>
<li><p>使用 <strong>@EnableXXX</strong> 机制</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(RobotAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableRobot &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完全自动配置</p>
<ul>
<li>在 <strong>resource</strong> 文件夹下的 <strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 文件中编写好我们自动配置类的全类名</li>
<li>项目启动，自动加载我们的自动配置类</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-4SpringBoot3新特性"><a href="#5-4SpringBoot3新特性" class="headerlink" title="5.4	SpringBoot3新特性"></a>5.4	SpringBoot3新特性</h3><ul>
<li><p>自动配置包位置变化</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>jakata api</strong> 迁移：<strong>druid</strong> 有问题</p>
</li>
<li><p>函数式 <strong>Web</strong>、<strong>ProblemDetails</strong></p>
</li>
<li><p><strong>GraalVM</strong> 与 <strong>AOT</strong></p>
</li>
<li><p>响应式编程全套</p>
</li>
</ul>
<h2 id="第六节NoSQL"><a href="#第六节NoSQL" class="headerlink" title="第六节	NoSQL"></a>第六节	NoSQL</h2><h3 id="6-1Redis整合"><a href="#6-1Redis整合" class="headerlink" title="6.1	Redis整合"></a>6.1	Redis整合</h3><ul>
<li><p><strong>整合场景</strong></p>
<ul>
<li><p>依赖导入</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">192.168.200.100</span></span><br><span class="line"><span class="attr">spring.data.redis.password</span>=<span class="string">Lfy123!@!</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试代码</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">redisTest</span><span class="params">()</span>&#123;</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;1234&quot;</span>,redisTemplate.opsForValue().get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>自动配置原理</strong></p>
<ul>
<li><p><strong>META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</strong> 文件中导入了 <strong>RedisAutoConfiguration</strong>、<strong>RedisReactiveAutoConfiguration</strong> 和 <strong>RedisRepositoriesAutoConfiguration</strong>，所有属性绑定在 <strong>RedisProperties</strong> </p>
</li>
<li><p><strong>RedisReactiveAutoConfiguration</strong> 属于响应式编程，<strong>RedisRepositoriesAutoConfiguration</strong> 属于 <strong>JPA</strong> 操作</p>
</li>
<li><p><strong>RedisAutoConfiguration</strong> 配置了以下组件</p>
<ul>
<li><p><strong>LettuceConnectionConfiguration</strong>：给容器中注入了连接工厂 <strong>LettuceConnectionFactory</strong>，和操作 <strong>redis</strong> 的客户端 <strong>DefaultClientResources</strong></p>
<ul>
<li><p>**RedisTemplate&lt;Object, Object&gt;**： 可给 <strong>redis</strong> 中存储任意对象，会使用 <strong>jdk</strong> 默认序列化方式</p>
</li>
<li><p><strong>StringRedisTemplate</strong>： 给 <strong>redis</strong> 中存储字符串，如果要存对象，需要开发人员自己进行序列化，<strong>key-value</strong> 都是字符串进行操作</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>定制化</strong></p>
<ul>
<li><p>序列化</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppRedisConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        template.setDefaultSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<ul>
<li><strong>Lettuce</strong>： 默认</li>
<li><strong>Jedis</strong>：可以使用以下切换</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--        切换 jedis 作为操作redis的底层客户端--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">8.130.74.183</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#spring.data.redis.client-type=lettuce</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#设置lettuce的底层参数</span></span><br><span class="line"><span class="comment">#spring.data.redis.lettuce.pool.enabled=true</span></span><br><span class="line"><span class="comment">#spring.data.redis.lettuce.pool.max-active=8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.data.redis.client-type</span>=<span class="string">jedis</span></span><br><span class="line"><span class="attr">spring.data.redis.jedis.pool.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.data.redis.jedis.pool.max-active</span>=<span class="string">8</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第七节接口文档"><a href="#第七节接口文档" class="headerlink" title="第七节	接口文档"></a>第七节	接口文档</h2><h3 id="7-1Swagger"><a href="#7-1Swagger" class="headerlink" title="7.1	Swagger"></a>7.1	Swagger</h3><ul>
<li><p><strong>整合场景</strong></p>
<ul>
<li><p>导入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /api-docs endpoint custom path 默认 /v3/api-docs</span></span><br><span class="line"><span class="attr">springdoc.api-docs.path</span>=<span class="string">/api-docs</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># swagger 相关配置在  springdoc.swagger-ui</span></span><br><span class="line"><span class="comment"># swagger-ui custom path</span></span><br><span class="line"><span class="attr">springdoc.swagger-ui.path</span>=<span class="string">/swagger-ui.html</span></span><br><span class="line"></span><br><span class="line"><span class="attr">springdoc.show-actuator</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>接口文档使用</strong></p>
<ul>
<li><p>常用注解</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>标注位置</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Tag</strong></td>
<td>controller 类</td>
<td>标识 controller 作用</td>
</tr>
<tr>
<td><strong>@Parameter</strong></td>
<td>参数</td>
<td>标识参数作用</td>
</tr>
<tr>
<td><strong>@Parameters</strong></td>
<td>参数</td>
<td>参数多重说明</td>
</tr>
<tr>
<td><strong>@Schema</strong></td>
<td>model 层的 JavaBean</td>
<td>描述模型作用及每个属性</td>
</tr>
<tr>
<td><strong>@Operation</strong></td>
<td>方法</td>
<td>描述方法作用</td>
</tr>
<tr>
<td><strong>@ApiResponse</strong></td>
<td>方法</td>
<td>描述响应状态码等</td>
</tr>
</tbody></table>
</li>
<li><p><strong>Docket</strong> 配置</p>
<ul>
<li><p>代码配置</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> GroupedOpenApi <span class="title function_">publicApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">          .group(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">          .pathsToMatch(<span class="string">&quot;/public/**&quot;</span>)</span><br><span class="line">          .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> GroupedOpenApi <span class="title function_">adminApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">          .group(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">          .pathsToMatch(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">          .addMethodFilter(method -&gt; method.isAnnotationPresent(Admin.class))</span><br><span class="line">          .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">springdoc.packagesToScan</span>=<span class="string">package1, package2</span></span><br><span class="line"><span class="attr">springdoc.pathsToMatch</span>=<span class="string">/v1, /api/balance/**</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>OpenAPI</strong> 配置</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> OpenAPI <span class="title function_">springShopOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">          .info(<span class="keyword">new</span> <span class="title class_">Info</span>().title(<span class="string">&quot;SpringShop API&quot;</span>)</span><br><span class="line">          .description(<span class="string">&quot;Spring shop sample application&quot;</span>)</span><br><span class="line">          .version(<span class="string">&quot;v0.0.1&quot;</span>)</span><br><span class="line">          .license(<span class="keyword">new</span> <span class="title class_">License</span>().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">          .externalDocs(<span class="keyword">new</span> <span class="title class_">ExternalDocumentation</span>()</span><br><span class="line">          .description(<span class="string">&quot;SpringShop Wiki Documentation&quot;</span>)</span><br><span class="line">          .url(<span class="string">&quot;https://springshop.wiki.github.org/docs&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Springfox 迁移</strong></p>
<ul>
<li><p>注解变化</p>
<table>
<thead>
<tr>
<th>原注解</th>
<th>现注解</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Api</strong></td>
<td><strong>@Tag</strong></td>
<td>描述Controller</td>
</tr>
<tr>
<td><strong>@ApiIgnore</strong></td>
<td><strong>@Parameter(hidden &#x3D; true)  @Operation(hidden &#x3D; true) @Hidden</strong></td>
<td>描述忽略操作</td>
</tr>
<tr>
<td><strong>@ApiImplicitParam</strong></td>
<td><strong>@Parameter</strong></td>
<td>描述参数</td>
</tr>
<tr>
<td><strong>@ApiImplicitParams</strong></td>
<td><strong>@Parameters</strong></td>
<td>描述参数</td>
</tr>
<tr>
<td><strong>@ApiModel</strong></td>
<td><strong>@Schema</strong></td>
<td>描述对象</td>
</tr>
<tr>
<td><strong>@ApiModelProperty(hidden &#x3D; true)</strong></td>
<td><strong>@Schema(accessMode &#x3D; READ_ONLY)</strong></td>
<td>描述对象属性</td>
</tr>
<tr>
<td><strong>@ApiModelProperty</strong></td>
<td><strong>@Schema</strong></td>
<td>描述对象属性</td>
</tr>
<tr>
<td><strong>@ApiOperation(value &#x3D; “foo”, notes &#x3D; “bar”)</strong></td>
<td><strong>@Operation(summary &#x3D; “foo”, description &#x3D; “bar”)</strong></td>
<td>描述方法</td>
</tr>
<tr>
<td><strong>@ApiParam</strong></td>
<td><strong>@Parameter</strong></td>
<td>描述参数</td>
</tr>
<tr>
<td><strong>@ApiResponse(code &#x3D; 404, message &#x3D; “foo”)</strong></td>
<td><strong>@ApiResponse(responseCode &#x3D; “404”, description &#x3D; “foo”)</strong></td>
<td>描述响应</td>
</tr>
</tbody></table>
</li>
<li><p><strong>Docket</strong> 配置</p>
<ul>
<li><p>旧写法</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">publicApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">          .select()</span><br><span class="line">          .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;org.github.springshop.web.public&quot;</span>))</span><br><span class="line">          .paths(PathSelectors.regex(<span class="string">&quot;/public.*&quot;</span>))</span><br><span class="line">          .build()</span><br><span class="line">          .groupName(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">          .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">adminApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">          .select()</span><br><span class="line">          .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;org.github.springshop.web.admin&quot;</span>))</span><br><span class="line">          .paths(PathSelectors.regex(<span class="string">&quot;/admin.*&quot;</span>))</span><br><span class="line">          .apis(RequestHandlerSelectors.withMethodAnnotation(Admin.class))</span><br><span class="line">          .build()</span><br><span class="line">          .groupName(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">          .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新写法</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> GroupedOpenApi <span class="title function_">publicApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">          .group(<span class="string">&quot;springshop-public&quot;</span>)</span><br><span class="line">          .pathsToMatch(<span class="string">&quot;/public/**&quot;</span>)</span><br><span class="line">          .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> GroupedOpenApi <span class="title function_">adminApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">          .group(<span class="string">&quot;springshop-admin&quot;</span>)</span><br><span class="line">          .pathsToMatch(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">          .addOpenApiMethodFilter(method -&gt; method.isAnnotationPresent(Admin.class))</span><br><span class="line">          .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加 <strong>OpenAPI</strong> 组件</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> OpenAPI <span class="title function_">springShopOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">          .info(<span class="keyword">new</span> <span class="title class_">Info</span>().title(<span class="string">&quot;SpringShop API&quot;</span>)</span><br><span class="line">          .description(<span class="string">&quot;Spring shop sample application&quot;</span>)</span><br><span class="line">          .version(<span class="string">&quot;v0.0.1&quot;</span>)</span><br><span class="line">          .license(<span class="keyword">new</span> <span class="title class_">License</span>().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">          .externalDocs(<span class="keyword">new</span> <span class="title class_">ExternalDocumentation</span>()</span><br><span class="line">          .description(<span class="string">&quot;SpringShop Wiki Documentation&quot;</span>)</span><br><span class="line">          .url(<span class="string">&quot;https://springshop.wiki.github.org/docs&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="第八节远程调用"><a href="#第八节远程调用" class="headerlink" title="第八节	远程调用"></a>第八节	远程调用</h2><h3 id="8-1远程调用"><a href="#8-1远程调用" class="headerlink" title="8.1	远程调用"></a>8.1	远程调用</h3><ul>
<li><p><strong>服务调用</strong></p>
<ul>
<li>本地过程调用：函数调用，不同方法都在同一个 <strong>JVM</strong> 运行</li>
<li>远程过程调用：服务提供者，服务消费者，通过连接对方服务器进行请求响应交互，来实现调用效果</li>
</ul>
</li>
<li><p><strong>API&#x2F;SDK的区别</strong></p>
<ul>
<li><strong>api</strong>：接口，远程提供功能</li>
</ul>
</li>
</ul>
<ul>
<li><strong>sdk</strong>：软件工具包，导入 <strong>jar</strong> 包，直接调用功能即可</li>
</ul>
<h3 id="8-2WebClient"><a href="#8-2WebClient" class="headerlink" title="8.2	WebClient"></a>8.2	WebClient</h3><ul>
<li><p><strong>创建和配置</strong></p>
<ul>
<li><p>创建客户端</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebClient.create()</span><br><span class="line">WebClient.create(String baseUrl)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置参数</p>
<ul>
<li><strong>uriBuilderFactory</strong>：自定义 <strong>UriBuilderFactory</strong> ，定义 <strong>baseurl</strong></li>
<li><strong>defaultUriVariables</strong>：默认 <strong>uri</strong> 变量</li>
<li><strong>defaultHeader</strong>：每个请求默认头</li>
<li><strong>defaultCookie</strong>：每个请求默认 <strong>cookie</strong></li>
<li><strong>defaultRequest</strong>：<strong>Consumer</strong> 自定义每个请求</li>
<li><strong>filter</strong>：过滤 <strong>client</strong> 发送的每个请求</li>
<li><strong>exchangeStrategies</strong>：<strong>HTTP</strong> 消息 <strong>reader</strong>&#x2F;<strong>writer</strong> 自定义</li>
<li><strong>clientConnector</strong>：<strong>HTTP</strong> <strong>client</strong> 库设置</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>获取响应</strong></p>
<ul>
<li><p>获取完整信息</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;https://example.org&quot;</span>);</span><br><span class="line">Mono&lt;ResponseEntity&lt;Person&gt;&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .toEntity(Person.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取 <strong>body</strong> 内容</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;https://example.org&quot;</span>);</span><br><span class="line">Mono&lt;Person&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Person.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取流数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Quote&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/quotes&quot;</span>).accept(MediaType.TEXT_EVENT_STREAM)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToFlux(Quote.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义错误处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;Person&gt; result = client.get()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .onStatus(HttpStatus::is4xxClientError, response -&gt; ...)</span><br><span class="line">        .onStatus(HttpStatus::is5xxServerError, response -&gt; ...)</span><br><span class="line">        .bodyToMono(Person.class);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>定义请求体</strong></p>
<ul>
<li><p>单个数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;Person&gt; personMono = ... ;</span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">        .body(personMono, Person.class)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Person&gt; personFlux = ... ;</span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_STREAM_JSON)</span><br><span class="line">        .body(personFlux, Person.class)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>普通对象</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> ... ;</span><br><span class="line">Mono&lt;Void&gt; result = client.post()</span><br><span class="line">        .uri(<span class="string">&quot;/persons/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">        .bodyValue(person)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Void.class);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="8-3HTTP-Interface"><a href="#8-3HTTP-Interface" class="headerlink" title="8.3	HTTP Interface"></a>8.3	HTTP Interface</h3><ul>
<li><p><strong>导入依赖</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>定义接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BingService</span> &#123;</span><br><span class="line">    <span class="meta">@GetExchange(url = &quot;/search&quot;)</span></span><br><span class="line">    String <span class="title function_">search</span><span class="params">(<span class="meta">@RequestParam(&quot;q&quot;)</span> String keyword)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建代理测试</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot05TaskApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.builder()</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://cn.bing.com&quot;</span>)</span><br><span class="line">                .codecs(clientCodecConfigurer -&gt; &#123;</span><br><span class="line">                    clientCodecConfigurer</span><br><span class="line">                            .defaultCodecs()</span><br><span class="line">                            .maxInMemorySize(<span class="number">256</span>*<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">HttpServiceProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> HttpServiceProxyFactory</span><br><span class="line">                .builder(WebClientAdapter.forClient(client)).build();</span><br><span class="line">        <span class="type">BingService</span> <span class="variable">bingService</span> <span class="operator">=</span> factory.createClient(BingService.class);</span><br><span class="line">        Mono&lt;String&gt; search = bingService.search(<span class="string">&quot;尚硅谷&quot;</span>);</span><br><span class="line">        search.subscribe(str -&gt; System.out.println(str));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="第九节消息服务"><a href="#第九节消息服务" class="headerlink" title="第九节	消息服务"></a>第九节	消息服务</h2><h3 id="9-1消息队列"><a href="#9-1消息队列" class="headerlink" title="9.1	消息队列"></a>9.1	消息队列</h3><ul>
<li><strong>异步</strong>：系统不需要立即处理请求，可以将请求放入消息队列中，稍后再处理，这有助于提升系统的响应速度</li>
<li><strong>解耦</strong>：将系统的各个组件独立开来，通过消息队列进行通信，一个组件的变更或故障不会直接影响到其他组件</li>
<li><strong>削峰</strong>：在高峰期间，通过消息队列平滑流量，防止系统过载</li>
<li><strong>缓冲</strong>：消息队列可以作为一个缓冲区，处理速度不匹配的组件之间的数据传输问题</li>
</ul>
<h3 id="9-2Kafka"><a href="#9-2Kafka" class="headerlink" title="9.2	Kafka"></a>9.2	Kafka</h3><ul>
<li><p><strong>消息模式</strong></p>
<ul>
<li>点对点模式：消息被发送到一个队列中，并且每条消息只会被一个消费者消费，确保了消息被一个消费者处理后即被删除，适用于需要确保每条消息仅被处理一次的场景</li>
<li>发布订阅模式：消息被发送到一个主题，并且可以被多个消费者订阅，每个订阅该主题的消费者都会接收到消息，适用于广播消息给多个接收者的场景</li>
</ul>
</li>
<li><p><strong>工作原理</strong></p>
<ul>
<li>分区<ul>
<li>分区是 <strong>Kafka</strong> 中的基本存储单位，每个主题可以分为多个分区，每个分区是一个有序的、不可变的消息序列</li>
<li>分区内的消息是有序的，每条消息都有一个唯一的偏移量</li>
<li>多个分区可以分布在不同的服务器上，允许并行处理，提高了系统的吞吐量</li>
<li>通过增加分区数量，可以更好地分配负载，避免单点瓶颈</li>
</ul>
</li>
<li>副本<ul>
<li>副本是指主题分区的冗余副本，用于实现数据的高可用性和容错，每个分区可以有多个副本，其中一个是主副本，其余的是副副本</li>
<li>副本机制确保即使某个节点发生故障，数据依然可用</li>
<li>当主副本不可用时，<strong>Kafka</strong> 会自动从副副本中选举一个新的主副本，保证系统的持续可用性</li>
<li>所有的读写操作首先发生在主副本上，然后副副本从主副本同步数据</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Kafka工作流程</strong></p>
<ul>
<li>消息写入<ul>
<li>生产者将消息发送到指定的主题</li>
<li><strong>Kafka</strong> 根据分区策略将消息写入到相应的分区的主副本</li>
</ul>
</li>
<li>数据同步<ul>
<li>副副本从主副本拉取数据并进行同步。</li>
<li>同步完成后，副副本会向主副本发送确认</li>
</ul>
</li>
<li>消息读取<ul>
<li>消费者从分区的主副本读取消息</li>
<li><strong>Kafka</strong> 确保同一分区内的消息顺序性，但不保证不同分区之间的消息顺序</li>
</ul>
</li>
<li>故障恢复<ul>
<li>当主副本故障时，<strong>Kafka</strong> 会从副副本中选举一个新的主副本，确保系统的高可用性</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>整合场景</strong></p>
<ul>
<li><p>导入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.bootstrap-servers</span>=<span class="string">172.20.128.1:9092</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>消息发送</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot07KafkaApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    KafkaTemplate kafkaTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">watch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        watch.start();</span><br><span class="line">        CompletableFuture[] futures = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="type">CompletableFuture</span> <span class="variable">send</span> <span class="operator">=</span> kafkaTemplate.send(<span class="string">&quot;order&quot;</span>, <span class="string">&quot;order.create.&quot;</span>+i, <span class="string">&quot;订单创建了：&quot;</span>+i);</span><br><span class="line">            futures[i]=send;</span><br><span class="line">        &#125;</span><br><span class="line">        CompletableFuture.allOf(futures).join();</span><br><span class="line">        watch.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;总耗时：&quot;</span>+watch.getTotalTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>消息监听</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMsgListener</span> &#123;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;order&quot;,groupId = &quot;order-service&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">(ConsumerRecord record)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收到消息：&quot;</span>+record); <span class="comment">//可以监听到发给kafka的新消息，以前的拿不到</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@KafkaListener(groupId = &quot;order-service-2&quot;,topicPartitions = &#123;</span></span><br><span class="line"><span class="meta">            @TopicPartition(topic = &quot;order&quot;,partitionOffsets = &#123;</span></span><br><span class="line"><span class="meta">                    @PartitionOffset(partition = &quot;0&quot;,initialOffset = &quot;0&quot;)</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenAll</span><span class="params">(ConsumerRecord record)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收到partion-0消息：&quot;</span>+record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>参数配置</strong></p>
<ul>
<li><p>消费者</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.consumer.value-deserializer</span>=<span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.properties[spring.json.value.default.type]</span>=<span class="string">com.example.Invoice</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.properties[spring.json.trusted.packages]</span>=<span class="string">com.example.main,com.example.another</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生产者</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.producer.value-serializer</span>=<span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span></span><br><span class="line"><span class="attr">spring.kafka.producer.properties[spring.json.add.type.headers]</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>自动配置原理</strong></p>
<ul>
<li><strong>kafka</strong> 自动配置在 <strong>KafkaAutoConfiguration</strong></li>
<li>容器中放了 <strong>KafkaTemplate</strong> 可以进行消息收发</li>
<li>容器中放了<strong>KafkaAdmin</strong> 可以进行 <strong>Kafka</strong> 的管理，比如创建 <strong>topic</strong> 等</li>
<li><strong>kafka</strong> 的配置在 <strong>KafkaProperties</strong> 中</li>
<li><strong>@EnableKafka</strong> 可以开启基于注解的模式</li>
</ul>
</li>
</ul>
<h2 id="第十节Web安全"><a href="#第十节Web安全" class="headerlink" title="第十节	Web安全"></a>第十节	Web安全</h2><h3 id="10-1安全架构"><a href="#10-1安全架构" class="headerlink" title="10.1	安全架构"></a>10.1	安全架构</h3><ul>
<li><strong>认证</strong>：确定用户身份，登录系统，用户系统</li>
<li><strong>授权</strong>：权限管理，用户授权</li>
<li><strong>攻击防护</strong>：XSS，CSRF，CORS，SQL注入</li>
<li><strong>权限模型</strong><ul>
<li><strong>RDBC</strong>：全称 <strong>Role Based Access Control</strong>，即基于角色的访问控制，具备用户表，用户_角色表，角色表，角色_权限表，权限表</li>
<li><strong>ACL</strong>：全称 <strong>Access Control List</strong>，即访问控制列表，直接用户和权限挂钩，具备用户表，用户_权限表，权限表</li>
</ul>
</li>
</ul>
<h3 id="10-2Spring-Security-原理"><a href="#10-2Spring-Security-原理" class="headerlink" title="10.2	Spring Security 原理"></a>10.2	Spring Security 原理</h3><ul>
<li><strong>过滤器链</strong>：<strong>Spring</strong> <strong>Security</strong> 利用 <strong>FilterChainProxy</strong> 封装一系列拦截器链，实现各种安全拦截功能</li>
<li><strong>FilterChainProxy</strong>：过滤链代理对象，包含多个过滤器，用于实现安全拦截功能</li>
<li><strong>SecurityFilterChain</strong>：安全过滤器链，在客户端和 <strong>Servlet</strong> 中的过滤器链中插入多个过滤器</li>
</ul>
<h3 id="10-3使用"><a href="#10-3使用" class="headerlink" title="10.3	使用"></a>10.3	使用</h3><ul>
<li><p><strong>HttpSecurity</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Order(SecurityProperties.BASIC_AUTH_ORDER - 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationConfigurerAdapter</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.antMatcher(<span class="string">&quot;/match1/**&quot;</span>)</span><br><span class="line">      .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/match1/user&quot;</span>).hasRole(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/match1/spam&quot;</span>).hasRole(<span class="string">&quot;SPAM&quot;</span>)</span><br><span class="line">        .anyRequest().isAuthenticated();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>MethodSecurity</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(securedEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleSecureApplication</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">  <span class="meta">@Secured(&quot;ROLE_USER&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">secure</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello Security&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="10-4实战"><a href="#10-4实战" class="headerlink" title="10.4	实战"></a>10.4	实战</h3><ul>
<li><p><strong>引入依赖</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置类</strong></p>
<ul>
<li><p>视图控制</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/home&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/hello&quot;</span>).setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/login&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安全配置</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeHttpRequests((requests) -&gt; requests</span><br><span class="line">                        .requestMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/home&quot;</span>).permitAll()</span><br><span class="line">                        .anyRequest().authenticated()</span><br><span class="line">                )</span><br><span class="line">                .formLogin((form) -&gt; form</span><br><span class="line">                        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                        .permitAll()</span><br><span class="line">                )</span><br><span class="line">                .logout((logout) -&gt; logout.permitAll());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span></span><br><span class="line">                User.withDefaultPasswordEncoder()</span><br><span class="line">                        .username(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                        .password(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                        .roles(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第十一节可观测性"><a href="#第十一节可观测性" class="headerlink" title="第十一节	可观测性"></a>第十一节	可观测性</h2><h3 id="11-1SpringBoot-Actuator"><a href="#11-1SpringBoot-Actuator" class="headerlink" title="11.1	SpringBoot Actuator"></a>11.1	SpringBoot Actuator</h3><ul>
<li><p><strong>实战流程</strong></p>
<ul>
<li><p>场景引入</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>暴露指标</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">endpoints</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">enabled-by-default</span>: <span class="string">true #暴露所有端点信息</span></span><br><span class="line">    <span class="attr">web</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">exposure</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">include</span>: <span class="string">&#x27;*&#x27;  #以web方式暴露</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>访问数据</p>
<ul>
<li>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator</a>：展示出所有可以用的监控端点</li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/beans">http://localhost:8080/actuator/beans</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/configprops">http://localhost:8080/actuator/configprops</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/metrics</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics/jvm.gc.pause">http://localhost:8080/actuator/metrics/jvm.gc.pause</a></li>
<li>[<a target="_blank" rel="noopener" href="http://localhost:8080/actuator/endpointName/detailPath">http://localhost:8080/actuator/endpointName/detailPath</a></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Endpoint</strong></p>
<ul>
<li><p>常用端点</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>auditevents</strong></td>
<td>暴露当前应用程序的审核事件信息，需要一个 <strong>AuditEventRepository</strong> 组件</td>
</tr>
<tr>
<td><strong>beans</strong></td>
<td>显示应用程序中所有 <strong>Spring</strong> <strong>Bean</strong> 的完整列表</td>
</tr>
<tr>
<td><strong>caches</strong></td>
<td>暴露可用的缓存</td>
</tr>
<tr>
<td><strong>conditions</strong></td>
<td>显示自动配置的所有条件信息，包括匹配或不匹配的原因</td>
</tr>
<tr>
<td><strong>configprops</strong></td>
<td>显示所有 <strong>@ConfigurationProperties</strong></td>
</tr>
<tr>
<td><strong>env</strong></td>
<td>暴露 <strong>Spring</strong> 的属性 <strong>ConfigurableEnvironment</strong></td>
</tr>
<tr>
<td><strong>flyway</strong></td>
<td>显示已应用的所有 <strong>Flyway</strong> 数据库迁移，需要一个或多个 <strong>Flyway</strong> 组件</td>
</tr>
<tr>
<td><strong>health</strong></td>
<td>显示应用程序运行状况信息</td>
</tr>
<tr>
<td><strong>httptrace</strong></td>
<td>显示 <strong>HTTP</strong> 跟踪信息，需要一个 <strong>HttpTraceRepository</strong> 组件</td>
</tr>
<tr>
<td><strong>info</strong></td>
<td>显示应用程序信息</td>
</tr>
<tr>
<td><strong>integrationgraph</strong></td>
<td>显示 <strong>Spring</strong>  <strong>integrationgraph</strong>，需要依赖 <strong>spring-integration-core</strong></td>
</tr>
<tr>
<td><strong>loggers</strong></td>
<td>显示和修改应用程序中日志的配置</td>
</tr>
<tr>
<td><strong>liquibase</strong></td>
<td>显示已应用的所有 <strong>Liquibase</strong> 数据库迁移，需要一个或多个 <strong>Liquibase</strong> 组件</td>
</tr>
<tr>
<td><strong>metrics</strong></td>
<td>显示当前应用程序的指标信息</td>
</tr>
<tr>
<td><strong>mappings</strong></td>
<td>显示所有 <strong>@RequestMapping</strong> 路径列表</td>
</tr>
<tr>
<td><strong>scheduledtasks</strong></td>
<td>显示应用程序中的计划任务</td>
</tr>
<tr>
<td><strong>sessions</strong></td>
<td>允许从<strong>Spring</strong> <strong>Session</strong>支持的会话存储中检索和删除用户会话，需要使用 <strong>Spring</strong> <strong>Session</strong> 的基于 <strong>Servlet</strong> 的 <strong>Web</strong> 应用程序</td>
</tr>
<tr>
<td><strong>shutdown</strong></td>
<td>使应用程序正常关闭，默认禁用</td>
</tr>
<tr>
<td><strong>startup</strong></td>
<td>显示由 <strong>ApplicationStartup</strong> 收集的启动步骤数据，需要使用 <strong>SpringApplication</strong> 进行配置 <strong>BufferingApplicationStartup</strong></td>
</tr>
<tr>
<td><strong>threaddump</strong></td>
<td>执行线程转储</td>
</tr>
<tr>
<td><strong>heapdump</strong></td>
<td>返回 <strong>hprof</strong> 堆转储文件</td>
</tr>
<tr>
<td><strong>jolokia</strong></td>
<td>通过 <strong>HTTP</strong> 暴露 <strong>JMX</strong> <strong>bean</strong>，需要引入依赖 <strong>jolokia-core</strong></td>
</tr>
<tr>
<td><strong>logfile</strong></td>
<td>返回日志文件的内容，支持使用 <strong>HTTP</strong> <strong>Range</strong> 标头来检索部分日志文件的内容</td>
</tr>
<tr>
<td><strong>prometheus</strong></td>
<td>以 <strong>Prometheus</strong> 服务器可以抓取的格式公开指标，需要依赖 <strong>micrometer-registry-prometheus</strong></td>
</tr>
</tbody></table>
</li>
<li><p>定制端点</p>
<ul>
<li><p>健康监控：返回存活或者死亡</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">errorCode</span> <span class="operator">=</span> check(); <span class="comment">// perform some specific health check</span></span><br><span class="line">        <span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down().withDetail(<span class="string">&quot;Error Code&quot;</span>, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构建Health</span></span><br><span class="line"><span class="type">Health</span> <span class="variable">build</span> <span class="operator">=</span> Health.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;error service&quot;</span>)</span><br><span class="line">                .withDetail(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>)</span><br><span class="line">                .withException(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>

  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">health</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">enabled</span>: <span class="string">true</span></span><br><span class="line">      <span class="attr">show-details</span>: <span class="string">always #总是显示详细信息。可显示每个模块的状态信息</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>指标监控：次数，发生率</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyService</span>&#123;</span><br><span class="line">    Counter counter;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(MeterRegistry meterRegistry)</span>&#123;</span><br><span class="line">         counter = meterRegistry.counter(<span class="string">&quot;myservice.method.running.counter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        counter.increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="11-2监控案例"><a href="#11-2监控案例" class="headerlink" title="11.2	监控案例"></a>11.2	监控案例</h3><ul>
<li><p><strong>安装</strong></p>
<ul>
<li><p>时序数据库</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装prometheus:时序数据库</span></span><br><span class="line">docker run -p 9090:9090 -d \</span><br><span class="line">-v pc:/etc/prometheus \</span><br><span class="line">prom/prometheus</span><br></pre></td></tr></table></figure>
</li>
<li><p>grafana</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装grafana；默认账号密码 admin:admin</span></span><br><span class="line">docker run -d --name=grafana -p 3000:3000 grafana/grafana</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>场景导入</strong></p>
<ul>
<li><p>引入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">endpoints</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">web</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">exposure</span>: <span class="string">#暴露所有监控的端点</span></span><br><span class="line">        <span class="attr">include</span>: <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>部署 <strong>Java</strong> 应用</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装上传工具</span></span><br><span class="line">yum install lrzsz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装openjdk</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载openjdk</span></span><br><span class="line">wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/java</span><br><span class="line">tar -xzf jdk-17_linux-x64_bin.tar.gz -C /opt/java/</span><br><span class="line">sudo vi /etc/profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">加入以下内容</span></span><br><span class="line">export JAVA_HOME=/opt/java/jdk-17.0.7</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">环境变量生效</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台启动java应用</span></span><br><span class="line">nohup java -jar boot3-14-actuator-0.0.1-SNAPSHOT.jar &gt; output.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>配置文件</strong></p>
  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改 prometheus.yml 配置文件</span></span><br><span class="line"><span class="attr">scrape_configs</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">-</span> <span class="string">job_name: &#x27;spring-boot-actuator-exporter&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path</span>: <span class="string">&#x27;/actuator/prometheus&#x27; #指定抓取的路径</span></span><br><span class="line">    <span class="attr">static_configs</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">targets: [&#x27;192.168.200.1:8001&#x27;]</span></span><br><span class="line">        <span class="attr">labels</span>:<span class="string"></span></span><br><span class="line">          <span class="attr">nodename</span>: <span class="string">&#x27;app-demo&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置监控面板</strong></p>
<ul>
<li>添加数据源</li>
<li>添加面板，可去 <strong>dashboard</strong> 市场找一个自己喜欢的面板，也可以自己开发面板</li>
</ul>
</li>
</ul>
<h2 id="第十二节AOT"><a href="#第十二节AOT" class="headerlink" title="第十二节	AOT"></a>第十二节	AOT</h2><h3 id="12-1AOT与JIT"><a href="#12-1AOT与JIT" class="headerlink" title="12.1	AOT与JIT"></a>12.1	AOT与JIT</h3><ul>
<li><p><strong>编译方式</strong></p>
<ul>
<li><p><strong>AOT</strong>：全称 <strong>Ahead-of-Time</strong>，即提前编译，程序执行前，全部被编译成机器码</p>
</li>
<li><p><strong>JIT</strong>：全称 <strong>Just in Time</strong>，即即时编译，程序执行前，全部被编译成机器码</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">JIT</th>
<th>AOT</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>优点</strong></td>
<td align="center">具备实时调整能力，生成最优机器指令，根据代码运行情况优化内存占用</td>
<td>速度快，优化了运行时编译时间和内存消耗，程序初期就能达最高性能，加快程序启动速度</td>
</tr>
<tr>
<td align="center"><strong>缺点</strong></td>
<td align="center">运行期边编译速度慢，初始编译不能达到最高性能</td>
<td>程序第一次编译占用时间长，牺牲高级语言一些特性</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p><strong>编译器和解释器</strong></p>
<table>
<thead>
<tr>
<th>对比项</th>
<th><strong>编译器</strong></th>
<th><strong>解释器</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>机器执行速度</strong></td>
<td>快，因为源代码只需被转换一次</td>
<td>慢，因为每行代码都需要被解释执行</td>
</tr>
<tr>
<td><strong>开发效率</strong></td>
<td>慢，因为需要耗费大量时间编译</td>
<td>快，无需花费时间生成目标代码，更快的开发和测试</td>
</tr>
<tr>
<td><strong>调试</strong></td>
<td>难以调试编译器生成的目标代码</td>
<td>容易调试源代码，因为解释器一行一行地执行</td>
</tr>
<tr>
<td><strong>可移植性（跨平台）</strong></td>
<td>不同平台需要重新编译目标平台代码</td>
<td>同一份源码可以跨平台执行，因为每个平台会开发对应的解释器</td>
</tr>
<tr>
<td><strong>学习难度</strong></td>
<td>相对较高，需要了解源代码、编译器以及目标机器的知识</td>
<td>相对较低，无需了解机器的细节</td>
</tr>
<tr>
<td><strong>错误检查</strong></td>
<td>编译器可以在编译代码时检查错误</td>
<td>解释器只能在执行代码时检查错误</td>
</tr>
<tr>
<td><strong>运行时增强</strong></td>
<td>无</td>
<td>可以动态增强</td>
</tr>
</tbody></table>
</li>
<li><p><strong>JVM架构</strong></p>
  <img src="C:\Users\86172\Pictures\Markdown\SpringBoot\JVM架构.png" style="zoom:67%;" />
</li>
<li><p><strong>Java执行过程</strong></p>
<p>  <img src="C:\Users\86172\Pictures\Markdown\SpringBoot\Java执行.png"></p>
</li>
<li><p><strong>JVM编译器</strong></p>
<ul>
<li>Client Compiler：注重启动速度和局部的优化</li>
<li>Server Compiler：更加关注全局优化，性能更好，但由于会进行更多的全局分析，所以启动速度会慢</li>
</ul>
</li>
<li><p><strong>分层编译</strong>：将 <strong>JVM</strong> 的执行状态分为了五个层次</p>
<ul>
<li>解释执行</li>
<li>执行不带 <strong>profiling</strong> 的 <strong>C1</strong> 代码</li>
<li>执行仅带方法调用次数以及循环回边执行次数 <strong>profiling</strong> 的 <strong>C1</strong> 代码</li>
<li>执行带所有 <strong>profiling</strong> 的 <strong>C1</strong> 代码</li>
<li>执行 <strong>C2</strong> 代码</li>
</ul>
</li>
</ul>
<h3 id="12-2GraalVM"><a href="#12-2GraalVM" class="headerlink" title="12.2	GraalVM"></a>12.2	GraalVM</h3><ul>
<li><p><strong>GraalVM</strong>：一个高性能 <strong>JDK</strong>，可提高基于 <strong>Java</strong> 和 <strong>JVM</strong> 的应用的性能并简化 <strong>Java</strong> 云原生服务的构建和运行，它提供优化的编译器，可以更快地生成代码并降低计算资源消耗，实现微服务即时启动</p>
</li>
<li><p><strong>使用流程</strong></p>
<ul>
<li><p>安装</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf graalvm-ce-java17-linux-amd64-22.3.2.tar.gz -C /opt/java/</span><br><span class="line"></span><br><span class="line">sudo vim /etc/profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改以下内容</span></span><br><span class="line">export JAVA_HOME=/opt/java/graalvm-ce-java17-22.3.2</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">gu install --file native-image-installable-svm-java17-linux-amd64-22.3.2.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">native-image -cp xxx.jar org.example.App</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="12-3SpringBoot整合"><a href="#12-3SpringBoot整合" class="headerlink" title="12.3	SpringBoot整合"></a>12.3	SpringBoot整合</h3><ul>
<li><p><strong>依赖导入</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>native-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>生成镜像</strong></p>
<ul>
<li><p>运行 <strong>aot</strong> 提前处理命令</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn springboot:process-aot</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行 <strong>native</strong> 打包</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -Pnative native:build</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第十三节Java响应式流"><a href="#第十三节Java响应式流" class="headerlink" title="第十三节	Java响应式流"></a>第十三节	Java响应式流</h2><h3 id="13-1Lambda表达式"><a href="#13-1Lambda表达式" class="headerlink" title="13.1	Lambda表达式"></a>13.1	Lambda表达式</h3><ul>
<li><p><strong>Lambda表达式</strong>：接口中有且只有一个未实现的方法，可以使用 <strong>Lambda</strong> 表达式简化</p>
</li>
<li><p><strong>语法格式</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(params) -&gt; &#123;function&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="13-2函数式接口"><a href="#13-2函数式接口" class="headerlink" title="13.2	函数式接口"></a>13.2	函数式接口</h3><ul>
<li><p><strong>函数式接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Function</span>&lt;T,R&gt; &#123;</span><br><span class="line">    R <span class="title function_">apply</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>供给者接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Supplier</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">get</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>消费者接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Consumer</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>断言者接口</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Predicate</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="13-3StreamAPI"><a href="#13-3StreamAPI" class="headerlink" title="13.3	StreamAPI"></a>13.3	StreamAPI</h3><ul>
<li><strong>中间操作</strong><ul>
<li>过滤：filter</li>
<li>一对一映射：mapToInt，mapToDouble，mapToLong</li>
<li>一对多映射：flatMap</li>
<li>排序：sorted</li>
<li>限制：limit</li>
<li>跳过：skip</li>
</ul>
</li>
<li><strong>终止操作</strong><ul>
<li>遍历：forEach</li>
<li>转数组：toArray</li>
<li>收集：collect</li>
<li>最值：max&#x2F;min</li>
<li>计数：count</li>
<li>头值：findFirst</li>
</ul>
</li>
</ul>
<h3 id="13-4Reactive-Stream"><a href="#13-4Reactive-Stream" class="headerlink" title="13.4	Reactive-Stream"></a>13.4	Reactive-Stream</h3><ul>
<li><strong>Reactive Streams</strong>：<strong>Java</strong> 面向流的库的标准和规范<ul>
<li>处理可能无限数量的元素</li>
<li>有序</li>
<li>在组件之间异步传递元素</li>
<li>强制性非阻塞，背压模式</li>
</ul>
</li>
<li><strong>API组件</strong><ul>
<li>Publisher：发布者，产生数据流</li>
<li>Subscriber：订阅者，消费数据流</li>
<li>Subscription：订阅关系，记录发布者和消费者之间的关系</li>
<li>Processor：处理器，同时实现发布者和订阅者，充当中间环节处理数据流</li>
</ul>
</li>
<li><strong>响应式编程</strong><ul>
<li>底层：数据缓冲队列，消息驱动模型，异步回调机制</li>
<li>编码：流式编程，链式调用，声明式 <strong>API</strong></li>
<li>效果：全异步，消息实时处理，高吞吐量，占用少量资源</li>
</ul>
</li>
</ul>
<h2 id="第十四节Reactor核心"><a href="#第十四节Reactor核心" class="headerlink" title="第十四节	Reactor核心"></a>第十四节	Reactor核心</h2><h3 id="14-1Reactor简介"><a href="#14-1Reactor简介" class="headerlink" title="14.1	Reactor简介"></a>14.1	Reactor简介</h3><ul>
<li><p><strong>Reactor</strong>：用于 <strong>JVM</strong> 的完全非阻塞的响应式编程框架，具备高效的需求管理能力，它与 <strong>Java</strong> 8 函数式 <strong>API</strong> 直接集成，提供了异步序列 <strong>API</strong> <strong>Flux</strong>和 <strong>Mono</strong>，并完全遵循和实现了响应式扩展规范</p>
</li>
<li><p><strong>项目构建</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="14-2响应式编程"><a href="#14-2响应式编程" class="headerlink" title="14.2	响应式编程"></a>14.2	响应式编程</h3><ul>
<li><strong>响应式编程</strong><ul>
<li>阻塞是对资源的浪费</li>
<li>异步编程，回调难以组合，代码难以理解和维护</li>
<li>从命令式编程到响应式编程，可编排性与可读性增强，数据装配流水线，操作符对数据进行处理</li>
</ul>
</li>
</ul>
<h3 id="14-3核心特性"><a href="#14-3核心特性" class="headerlink" title="14.3	核心特性"></a>14.3	核心特性</h3><ul>
<li><p><strong>Mono 和 Flux</strong></p>
<ul>
<li>Mono：01 数据流</li>
<li>Flux：N 数据流</li>
<li>响应式流：元素 + 信号</li>
</ul>
</li>
<li><p><strong>订阅</strong></p>
<ul>
<li><p>信号感知回调</p>
<ul>
<li><p>元素处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v), <span class="comment">//流元素消费</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>异常处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">throwable -&gt; System.out.println(<span class="string">&quot;throwable = &quot;</span> + throwable), <span class="comment">//感知异常结束</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>结束处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">()-&gt; System.out.println(<span class="string">&quot;流结束了...&quot;</span>) <span class="comment">//感知正常结束</span></span><br></pre></td></tr></table></figure></li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flux.subscribe(</span><br><span class="line">        v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v), <span class="comment">//流元素消费</span></span><br><span class="line">        throwable -&gt; System.out.println(<span class="string">&quot;throwable = &quot;</span> + throwable), <span class="comment">//感知异常结束</span></span><br><span class="line">        ()-&gt; System.out.println(<span class="string">&quot;流结束了...&quot;</span>) <span class="comment">//感知正常结束</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义消费者（生命周期钩子）</p>
<ul>
<li><p>订阅关系绑定</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">    <span class="comment">// 流被订阅的时候触发</span></span><br><span class="line">    System.out.println(<span class="string">&quot;绑定了...&quot;</span>+subscription);</span><br><span class="line">    <span class="comment">//找发布者要数据</span></span><br><span class="line">    request(<span class="number">1</span>); <span class="comment">//要1个数据</span></span><br><span class="line"><span class="comment">//  requestUnbounded(); //要无限数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据到达</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(String value)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;数据到达，正在处理：&quot;</span>+value);</span><br><span class="line">    request(<span class="number">1</span>); <span class="comment">//要1个数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完成</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnComplete</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;流正常结束...&quot;</span>);</span><br><span class="line">&#125;     </span><br></pre></td></tr></table></figure>
</li>
<li><p>错误</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnError</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;流异常...&quot;</span>+throwable);</span><br><span class="line">&#125;           </span><br></pre></td></tr></table></figure>
</li>
<li><p>取消</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnCancel</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;流被取消...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最终回调</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookFinally</span><span class="params">(SignalType type)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;最终回调...一定会被执行&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">flux.subscribe(<span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(String value)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnComplete</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnError</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnCancel</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookFinally</span><span class="params">(SignalType type)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>流的取消</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(String value)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;数据到达，正在处理：&quot;</span>+value);</span><br><span class="line">    <span class="keyword">if</span>(value.equals(<span class="string">&quot;哈哈：5&quot;</span>))&#123;</span><br><span class="line">        cancel(); <span class="comment">//取消流</span></span><br><span class="line">    &#125;</span><br><span class="line">    request(<span class="number">1</span>); <span class="comment">//要1个数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>背压和请求重塑</strong></p>
<ul>
<li><p>缓冲</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;List&lt;Integer&gt;&gt; flux = Flux.range(<span class="number">1</span>, <span class="number">10</span>)  <span class="comment">//原始流10个</span></span><br><span class="line">        .buffer(<span class="number">3</span>)</span><br><span class="line">        .log();<span class="comment">//缓冲区：缓冲3个元素: 消费一次最多可以拿到三个元素； 凑满数批量发给消费者</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        //一次发一个，一个一个发；</span></span><br><span class="line"><span class="comment">// 10元素，buffer(3)；消费者请求4次，数据消费完成</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>限流</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .log()</span><br><span class="line">    <span class="comment">//限流触发，看上游是怎么限流获取数据的</span></span><br><span class="line">    .limitRate(<span class="number">100</span>) <span class="comment">//一次预取30个元素； 第一次 request(100)，以后request(75)</span></span><br><span class="line">    .subscribe();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>以编程的方式创建序列</strong></p>
<ul>
<li><p>同步环境</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Fulx&lt;Object&gt; flux = </span><br><span class="line">    Flux.generate(() -&gt; <span class="number">0</span>, <span class="comment">// 初始值</span></span><br><span class="line">                  (srate,sink) -&gt; &#123;</span><br><span class="line">                      <span class="keyword">if</span>(state &lt;= <span class="number">10</span>)&#123;</span><br><span class="line">                          sink.next(state);</span><br><span class="line">                      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                          sink.complete();</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">if</span>(state == <span class="number">7</span>)&#123;</span><br><span class="line">                          sink.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>());</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">                  &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>多线程</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Fulx&lt;Object&gt; flux = </span><br><span class="line">    Flux.create(fluxSink -&gt; &#123;</span><br><span class="line">        <span class="type">MyListener</span> <span class="variable">listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyListener</span>(fluxSink); <span class="comment">// 监听器</span></span><br><span class="line">        listener.online();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>处理规则</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">        .handle((value,sink)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;拿到的值：&quot;</span>+value);</span><br><span class="line">            sink.next(<span class="string">&quot;张三：&quot;</span>+value); <span class="comment">//可以向下发送数据的通道</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .log() <span class="comment">//日志</span></span><br><span class="line">        .subscribe();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>线程调度</strong></p>
<ul>
<li><p>默认使用当前线程，生成流，发布流，流操作</p>
</li>
<li><p>当前线程</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scheduler</span> <span class="variable">s</span> <span class="operator">=</span> Schedulers.immediate();</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建单线程</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scheduler</span> <span class="variable">s</span> <span class="operator">=</span> Schedulers.single();</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建多线程</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scheduler</span> <span class="variable">s</span> <span class="operator">=</span> Schedulers.boundedElastic();</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义线程池</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scheduler</span> <span class="variable">s</span> <span class="operator">=</span> Schedulers.fromExecutor();</span><br></pre></td></tr></table></figure>
</li>
<li><p>绑定调度策略</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;String&gt; flux = Flux</span><br><span class="line">    .range(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    .map(i -&gt; <span class="number">10</span> + i)</span><br><span class="line">    .log()</span><br><span class="line">    .publishOn(s)</span><br><span class="line">    .map(i -&gt; <span class="string">&quot;value &quot;</span> + i);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>错误处理</strong></p>
<ul>
<li><p>消费者默认处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flux.subscribe(</span><br><span class="line">        v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v), <span class="comment">//流元素消费</span></span><br><span class="line">        throwable -&gt; System.out.println(<span class="string">&quot;throwable = &quot;</span> + throwable), <span class="comment">//感知异常结束</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回值：onErrorReturn</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">        .onErrorReturn(NullPointerException.class,<span class="string">&quot;哈哈-6666&quot;</span>)</span><br><span class="line">        .subscribe(v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err -&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err),</span><br><span class="line">                ()-&gt; System.out.println(<span class="string">&quot;流结束&quot;</span>)); <span class="comment">// error handling example</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行方法：onErrorResume</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">    	.onErrorResume(err -&gt; Mono.just(<span class="string">&quot;哈哈-777&quot;</span>))</span><br><span class="line">        .subscribe(v -&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err -&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err),</span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;流结束&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一个新值：onErrorResume</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">    	.onErrorResume(err -&gt; Flux.error(<span class="keyword">new</span> <span class="title class_">BusinessException</span>(err.getMessage()+<span class="string">&quot;：炸了&quot;</span>)))</span><br><span class="line">        .subscribe(v -&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err -&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err),</span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;流结束&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>包装异常并抛出：onErrorMap</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">        .onErrorMap(err-&gt; <span class="keyword">new</span> <span class="title class_">BusinessException</span>(err.getMessage()+<span class="string">&quot;: 又炸了...&quot;</span>))</span><br><span class="line">        .subscribe(v -&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err -&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err),</span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;流结束&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>记录错误日志并抛出：doOnError</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">        .doOnError(err -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;err已被记录 = &quot;</span> + err);</span><br><span class="line">        &#125;).subscribe(v -&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err -&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err),</span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;流结束&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭资源：doFinally</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">        .map(i -&gt; <span class="string">&quot;100 / &quot;</span> + i + <span class="string">&quot; = &quot;</span> + (<span class="number">100</span> / i))</span><br><span class="line">        .doOnError(err -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;err已被记录 = &quot;</span> + err);</span><br><span class="line">        &#125;)</span><br><span class="line">        .doFinally(signalType -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;流信号：&quot;</span>+signalType);</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>忽略异常：onErrorContinue</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">        .map(i-&gt;<span class="number">10</span>/i)</span><br><span class="line">        .onErrorContinue((err,val)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;err = &quot;</span> + err);</span><br><span class="line">            System.out.println(<span class="string">&quot;val = &quot;</span> + val);</span><br><span class="line">            System.out.println(<span class="string">&quot;发现&quot;</span>+val+<span class="string">&quot;有问题了，继续执行其他的，我会记录这个问题&quot;</span>);</span><br><span class="line">        &#125;) <span class="comment">//发生</span></span><br><span class="line">        .subscribe(v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v),</span><br><span class="line">                err-&gt; System.out.println(<span class="string">&quot;err = &quot;</span> + err));</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>常用操作</strong></p>
<ul>
<li><p><strong>filter</strong>：过滤器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.filter(i % <span class="number">2</span> == <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>flatMap</strong>：扁平化</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.flatMap(v -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromArray(v.split(<span class="string">&quot; &quot;</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>concat&#x2F;concatWith&#x2F;concatMap</strong>：连接</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.concat(Flux.just(<span class="number">1</span>,<span class="number">2</span>),Flux.just(<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>transform&#x2F;transfromDeferred</strong>：转换</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.transform(values -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> values.map(String::toUpperCase)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>defaultIfEmpty&#x2F;switchIfEmpty</strong>：默认值</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.defaultIfEmpty(<span class="string">&quot;a&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>merge&#x2F;mergeWith</strong>：合并</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.merge(Flux.just(<span class="number">1</span>,<span class="number">2</span>),Flux.just(<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>zip&#x2F;zipWith</strong>：压缩</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.zipWith(Flux.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>超时与重试</strong></p>
<ul>
<li><p>超时：timeout</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.delayElements(Duratons.ofSeconds(<span class="number">3</span>))</span><br><span class="line">.timeout(Durations.ofSeconds(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>重试：retry，从头到尾重新请求</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.retry(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>缓存</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.cache(<span class="number">3</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>阻塞式API</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.collecList()</span><br><span class="line">.block()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>并发流</strong></p>
<ul>
<li><p>并发</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.parallel(<span class="number">8</span>)</span><br><span class="line">.runOn(Schedulers.newparallel(<span class="string">&quot;abc&quot;</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>上下文读写</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.contextWrite(Context.of(<span class="string">&quot;k&quot;</span>,<span class="string">&quot;v&quot;</span>))</span><br><span class="line">cotext.get(<span class="string">&quot;k&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="14-4Sinks工具类"><a href="#14-4Sinks工具类" class="headerlink" title="14.4	Sinks工具类"></a>14.4	Sinks工具类</h3><ul>
<li><p><strong>Sinks类</strong></p>
<ul>
<li><p>接收器，数据管道，所有的数据顺着管道流动</p>
</li>
<li><p>发送 <strong>Flux</strong> 数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flux.many()</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送 <strong>Mono</strong> 数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flux.one()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>传播机制</strong></p>
<ul>
<li><p>单播</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flux.many().unicast()</span><br></pre></td></tr></table></figure>
</li>
<li><p>多播</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flux.many().multicast()</span><br></pre></td></tr></table></figure>
</li>
<li><p>重放</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flux.many().replay()</span><br></pre></td></tr></table></figure>
</li>
<li><p>背压</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.onBackpressurebuffer()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="第十五节Spring-Webflux"><a href="#第十五节Spring-Webflux" class="headerlink" title="第十五节	Spring Webflux"></a>第十五节	Spring Webflux</h2><h3 id="15-1WebFlux简介"><a href="#15-1WebFlux简介" class="headerlink" title="15.1	WebFlux简介"></a>15.1	WebFlux简介</h3><ul>
<li><p><strong>WebFlux</strong>：响应式堆栈 <strong>Web</strong> 框架， 完全无阻塞，支持响应式流背压，并在以下服务器上运行 <strong>Netty</strong>、<strong>Undertow</strong> 和 <strong>Servlet</strong> 容器</p>
<ul>
<li>需要一个非阻塞的 <strong>web</strong> 堆栈来处理少量线程的并发性，并用更少的硬件资源进行扩展</li>
<li>函数式编程，在 <strong>Java</strong> 8 中添加 <strong>lambda</strong> 表达式为 <strong>Java</strong> 中的函数式 <strong>API</strong> 创造了机会，允许声明性 异步逻辑的组成</li>
</ul>
</li>
<li><p><strong>依赖引入</strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="15-2WebFlux核心"><a href="#15-2WebFlux核心" class="headerlink" title="15.2	WebFlux核心"></a>15.2	WebFlux核心</h3><ul>
<li><p><strong>HttpHandler</strong>：网络请求处理器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (ServerHttpRequest request,</span><br><span class="line">                           ServerHttpResponse response)-&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> response.writeWith(Mono.just(<span class="number">0</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>获取响应头</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.getHeaders(); <span class="comment">//获取响应头</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取 <strong>cookie</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.getCookies(); <span class="comment">//获取Cookie</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取响应状态码</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.getStatusCode(); <span class="comment">//获取响应状态码；</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>缓存 <strong>buffer</strong> 工厂</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.bufferFactory(); <span class="comment">//buffer工厂</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>写入数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.writeWith() <span class="comment">//把xxx写出去</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>响应结束</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setComplete(); <span class="comment">//响应结束</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>返回数据</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建 响应数据的 DataBuffer</span></span><br><span class="line"><span class="type">DataBufferFactory</span> <span class="variable">factory</span> <span class="operator">=</span> response.bufferFactory();</span><br><span class="line"><span class="comment">//数据Buffer</span></span><br><span class="line"><span class="type">DataBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> factory.wrap(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello!&quot;</span>).getBytes());</span><br><span class="line"><span class="comment">// 需要一个 DataBuffer 的发布者</span></span><br><span class="line"><span class="keyword">return</span> response.writeWith(Mono.just(buffer));</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>HttpServer</strong>：服务器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启动一个服务器，监听8080端口，接受数据，拿到数据交给 HttpHandler 进行请求处理</span></span><br><span class="line"><span class="type">ReactorHttpHandlerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReactorHttpHandlerAdapter</span>(handler);</span><br><span class="line"><span class="comment">// 启动Netty服务器</span></span><br><span class="line">HttpServer.create()</span><br><span class="line">        .host(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">        .port(<span class="number">8080</span>)</span><br><span class="line">        .handle(adapter) <span class="comment">//用指定的处理器处理请求</span></span><br><span class="line">        .bindNow(); <span class="comment">//现在就绑定</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>DispatcherHandler</strong>：前端控制器</p>
<ul>
<li><p><strong>HandlerMapping</strong>：请求映射处理器，保存每个请求由哪个方法进行处理</p>
</li>
<li><p><strong>HandlerAdapter</strong>：处理器适配器，反射执行目标方法</p>
</li>
<li><p><strong>HandlerResultHandler</strong>：处理器结果处理器</p>
</li>
<li><p><strong>handle</strong> 方法：处理所有请求，分配 <strong>handler</strong> 对象</p>
<ul>
<li><p>请求和响应都封装在 <strong>ServerWebExchange</strong> 对象中，由 <strong>handle</strong> 方法进行处理</p>
</li>
<li><p>如果没有任何的请求映射器，直接返回一个创建一个未找到的错误 404，返回 <strong>Mono.error</strong> 终结流</p>
</li>
<li><p>跨域工具，是否跨域请求，跨域请求检查是否复杂跨域，需要预检请求</p>
</li>
<li><p><strong>Flux</strong> 流式操作，先找到 <strong>HandlerMapping</strong>，再获取 <strong>handlerAdapter</strong>，再用 <strong>Adapter</strong> 处理请求，期间的错误由 <strong>onErrorResume</strong> 触发回调进行处理</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange)</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> createNotFoundError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (CorsUtils.isPreFlightRequest(exchange.getRequest())) &#123;</span><br><span class="line">        <span class="keyword">return</span> handlePreFlight(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(<span class="built_in">this</span>.handlerMappings) <span class="comment">//拿到所有的 handlerMappings</span></span><br><span class="line">            .concatMap(mapping -&gt; mapping.getHandler(exchange)) <span class="comment">//找每一个mapping看谁能处理请求</span></span><br><span class="line">            .next() <span class="comment">//直接触发获取元素； 拿到流的第一个元素； 找到第一个能处理这个请求的handlerAdapter</span></span><br><span class="line">            .switchIfEmpty(createNotFoundError()) <span class="comment">//如果没拿到这个元素，则响应404错误；</span></span><br><span class="line">            .onErrorResume(ex -&gt; handleDispatchError(exchange, ex)) <span class="comment">//异常处理，一旦前面发生异常，调用处理异常</span></span><br><span class="line">            .flatMap(handler -&gt; handleRequestWith(exchange, handler)); <span class="comment">//调用方法处理请求，得到响应结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>handleRequestWith</strong> 方法：<strong>handlerAdapter</strong> 处理请求逻辑</p>
</li>
<li><p><strong>handleResult</strong> 方法：处理各种类型结果</p>
</li>
</ul>
</li>
</ul>
<h3 id="15-3WebFlux开发"><a href="#15-3WebFlux开发" class="headerlink" title="15.3	WebFlux开发"></a>15.3	WebFlux开发</h3><ul>
<li><p><strong>目标方法传参</strong></p>
<ul>
<li><strong>ServerWebExchange</strong>：封装了请求和响应对象的对象，自定义获取数据，自定义响应</li>
<li><strong>ServerHttpRequest</strong>：请求</li>
<li><strong>ServerHttpResponse</strong>：响应</li>
<li><strong>WebSession</strong>  访问 <strong>Session</strong> 对象</li>
<li><strong>org.springframework.http.HttpMethod</strong>：请求方式</li>
<li><strong>@PathVariable</strong>：路径变量</li>
<li><strong>@RequestParam</strong>：请求参数</li>
<li><strong>@CookieValue</strong>：获取 <strong>Cookie</strong></li>
<li><strong>@RequestBody</strong>：获取请求体，<strong>Post</strong>，文件上传</li>
<li><strong>@RequestPart</strong>：获取文件上传的数据 <strong>multipart&#x2F;form-data</strong></li>
</ul>
</li>
<li><p><strong>返回值格式</strong></p>
<ul>
<li><strong>@ResponseBody</strong>：将响应数据写出去，如果是对象，将自动转换为 JSON。</li>
<li>**HttpEntity&lt;\B&gt;<strong>、</strong>ResponseEntity&lt;\B&gt;**：支持快速自定义响应内容，包括状态码、头信息和响应体</li>
<li><strong>HttpHeaders</strong>：只有响应头，没有响应内容</li>
<li><strong>ErrorResponse</strong>：快速构建错误响应</li>
<li><strong>ProblemDetail</strong>：<strong>SpringBoot</strong> 中的错误响应类型</li>
<li><strong>String</strong>：返回字符串类型的响应内容</li>
<li><strong>forward</strong>：转发到一个地址</li>
<li><strong>redirect</strong>：重定向到一个地址</li>
<li>配合模板引擎，返回视图对象：<ul>
<li><strong>View</strong>：直接返回视图对象。</li>
<li><strong>java.util.Map</strong>、<strong>org.springframework.ui.Model</strong>：返回模型数据</li>
<li><strong>@ModelAttribute</strong>：返回模型数据</li>
</ul>
</li>
<li><strong>Rendering</strong>：新版的页面跳转 <strong>API</strong>，不能标注 <strong>@ResponseBody</strong> 注解</li>
<li><strong>void</strong>：仅代表响应完成信号</li>
<li><strong>Flux&lt;\ServerSentEvent&gt;<strong>、</strong>Observable&lt;\ServerSentEvent&gt;</strong> 或其他响应式类型：使用 <strong>text&#x2F;event-stream</strong> 完成服务器推送事件效果</li>
<li>其他返回值：未在上述列表中的其他返回值，都会被当成给页面的数据</li>
</ul>
</li>
<li><p><strong>文件上传</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(<span class="meta">@RequestPart(&quot;meta-data&quot;)</span> Part metadata, </span></span><br><span class="line"><span class="params">		<span class="meta">@RequestPart(&quot;file-data&quot;)</span> FilePart file)</span> &#123; </span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>错误处理</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">error</span><span class="params">(ArithmeticException exception)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;炸了，哈哈...&quot;</span>;</span><br><span class="line">&#125;=</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自定义Flux配置</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebFluxConfigurer <span class="title function_">webFluxConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebFluxConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">                registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                        .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                        .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                        .allowedOrigins(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>过滤器Filter</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line"></span><br><span class="line">        Mono&lt;Void&gt; filter = chain.filter(exchange); <span class="comment">//放行</span></span><br><span class="line">        Mono&lt;Void&gt; voidMono = filter.doOnError(err -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;目标方法异常以后...&quot;</span>);</span><br><span class="line">                &#125;) <span class="comment">// 目标方法发生异常后做事</span></span><br><span class="line">                .doFinally(signalType -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;目标方法执行以后...&quot;</span>);</span><br><span class="line">                &#125;);<span class="comment">// 目标方法执行之后</span></span><br><span class="line">        <span class="comment">//上面执行不花时间。</span></span><br><span class="line">        <span class="keyword">return</span> voidMono; <span class="comment">//看清楚返回的是谁！！！</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="第十六节R2DBC"><a href="#第十六节R2DBC" class="headerlink" title="第十六节	R2DBC"></a>第十六节	R2DBC</h2><h3 id="16-1R2DBC简介"><a href="#16-1R2DBC简介" class="headerlink" title="16.1	R2DBC简介"></a>16.1	R2DBC简介</h3><ul>
<li><p><strong>R2DBC</strong>：响应式关系数据库连接项目为关系数据库带来了响应式编程 API</p>
<ul>
<li>基于 <strong>Reactive</strong> <strong>Streams</strong> 规范</li>
<li>适用于关系数据库</li>
<li>支持可扩展的解决方案</li>
<li>提供开放规范</li>
</ul>
</li>
<li><p><strong>构建项目</strong></p>
<ul>
<li><p>导入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.asyncer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-mysql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据库</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MySqlConnectionConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> MySqlConnectionConfiguration.builder()</span><br><span class="line">            .host(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">            .port(<span class="number">3306</span>)</span><br><span class="line">            .username(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">            .database(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">            .build();</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取连接工厂</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MySqlConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> MySqlConnectionFactory.from(configuration);</span><br></pre></td></tr></table></figure>

</li>
<li><p>数据发布</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Mono.from(connectionFactory.create())</span><br><span class="line">    .flatMapMany(connection -&gt;</span><br><span class="line">            connection</span><br><span class="line">                    .createStatement(<span class="string">&quot;select * from t_author where id=?id and name=?name&quot;</span>)</span><br><span class="line">                    .bind(<span class="string">&quot;id&quot;</span>,<span class="number">1L</span>) <span class="comment">//具名参数</span></span><br><span class="line">                    .bind(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">                    .execute()</span><br><span class="line">    ).flatMap(result -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> result.map(readable -&gt; &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> readable.get(<span class="string">&quot;id&quot;</span>, Long.class);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> readable.get(<span class="string">&quot;name&quot;</span>, String.class);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TAuthor</span>(id, name);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribe(tAuthor -&gt; System.out.println(<span class="string">&quot;tAuthor = &quot;</span> + tAuthor))</span><br><span class="line">;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="16-2Spring-Data-R2DBC"><a href="#16-2Spring-Data-R2DBC" class="headerlink" title="16.2	Spring Data R2DBC"></a>16.2	Spring Data R2DBC</h3><ul>
<li><p><strong>SpringBoot整合R2BDC</strong></p>
<ul>
<li><p>引入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.asyncer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-mysql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">r2dbc:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">r2dbc:mysql://localhost:3306/test</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>数据访问层使用</strong></p>
<ul>
<li><p>定义接口</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorRepositories</span> <span class="keyword">extends</span> <span class="title class_">R2dbcRepository</span>&lt;TAuthor,Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Flux&lt;TAuthor&gt; <span class="title function_">findAllByIdInAndNameLike</span><span class="params">(Collection&lt;Long&gt; id, String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;select * from t_author&quot;)</span> <span class="comment">//自定义query注解，指定sql语句</span></span><br><span class="line">    Flux&lt;TAuthor&gt; <span class="title function_">findHaha</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义转换器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ReadingConverter</span> <span class="comment">//读取数据库数据的时候,把row转成 TBook</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;Row, TBook&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TBook <span class="title function_">convert</span><span class="params">(Row source)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(source == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//自定义结果集的封装</span></span><br><span class="line">        <span class="type">TBook</span> <span class="variable">tBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TBook</span>();</span><br><span class="line"></span><br><span class="line">        tBook.setId(source.get(<span class="string">&quot;id&quot;</span>, Long.class));</span><br><span class="line">        tBook.setTitle(source.get(<span class="string">&quot;title&quot;</span>, String.class));</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">author_id</span> <span class="operator">=</span> source.get(<span class="string">&quot;author_id&quot;</span>, Long.class);</span><br><span class="line">        tBook.setAuthorId(author_id);</span><br><span class="line">        <span class="comment">//        tBook.setPublishTime(source.get(&quot;publish_time&quot;, Instant.class));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">TAuthor</span> <span class="variable">tAuthor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TAuthor</span>();</span><br><span class="line">        tAuthor.setId(author_id);</span><br><span class="line">        tAuthor.setName(source.get(<span class="string">&quot;name&quot;</span>, String.class));</span><br><span class="line"></span><br><span class="line">        tBook.setAuthor(tAuthor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置生效</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableR2dbcRepositories</span> <span class="comment">//开启 R2dbc 仓库功能；jpa</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R2DbcConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//替换容器中原来的</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> R2dbcCustomConversions <span class="title function_">conversions</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把我们的转换器加入进去； 效果新增了我们的 Converter</span></span><br><span class="line">        <span class="keyword">return</span> R2dbcCustomConversions.of(MySqlDialect.INSTANCE,<span class="keyword">new</span> <span class="title class_">BookConverter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="16-3RBAC-SOL"><a href="#16-3RBAC-SOL" class="headerlink" title="16.3	RBAC-SOL"></a>16.3	RBAC-SOL</h3><ul>
<li><p><strong>一对一查询</strong></p>
<ul>
<li><p>自定义转换器</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">R2dbcCustomConversions <span class="title function_">r2dbcCustomConversions</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Converter&lt;?, ?&gt;&gt; converters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    converters.add(<span class="keyword">new</span> <span class="title class_">BookConverter</span>());</span><br><span class="line">    <span class="keyword">return</span> R2dbcCustomConversions.of(MySqlDialect.INSTANCE, converters);</span><br><span class="line">&#125;</span><br><span class="line">bookRepostory.hahaBook(<span class="number">1L</span>)</span><br><span class="line">        .subscribe(tBook -&gt; System.out.println(<span class="string">&quot;tBook = &quot;</span> + tBook));</span><br></pre></td></tr></table></figure>
</li>
<li><p>编程封装：使用 <strong>DatabaseClient</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">databaseClient.sql(<span class="string">&quot;select b.*,t.name as name from t_book b &quot;</span> +</span><br><span class="line">            <span class="string">&quot;LEFT JOIN t_author t on b.author_id = t.id &quot;</span> +</span><br><span class="line">            <span class="string">&quot;WHERE b.id = ?&quot;</span>)</span><br><span class="line">    .bind(<span class="number">0</span>, <span class="number">1L</span>)</span><br><span class="line">    .fetch()</span><br><span class="line">    .all()</span><br><span class="line">    .map(row-&gt; &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> row.get(<span class="string">&quot;id&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> row.get(<span class="string">&quot;title&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">author_id</span> <span class="operator">=</span> row.get(<span class="string">&quot;author_id&quot;</span>).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> row.get(<span class="string">&quot;name&quot;</span>).toString();</span><br><span class="line">        <span class="type">TBook</span> <span class="variable">tBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TBook</span>();</span><br><span class="line"></span><br><span class="line">        tBook.setId(Long.parseLong(id));</span><br><span class="line">        tBook.setTitle(title);</span><br><span class="line"></span><br><span class="line">        <span class="type">TAuthor</span> <span class="variable">tAuthor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TAuthor</span>();</span><br><span class="line">        tAuthor.setName(name);</span><br><span class="line">        tAuthor.setId(Long.parseLong(author_id));</span><br><span class="line"></span><br><span class="line">        tBook.setAuthor(tAuthor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tBook;</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribe(tBook -&gt; System.out.println(<span class="string">&quot;tBook = &quot;</span> + tBook));</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>一对多查询</strong>：使用底层 <strong>API</strong> <strong>DatabaseClient</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;TAuthor&gt; flux = databaseClient.sql(<span class="string">&quot;select a.id aid,a.name,b.* from t_author a  &quot;</span> +</span><br><span class="line">                <span class="string">&quot;left join t_book b on a.id = b.author_id &quot;</span> +</span><br><span class="line">                <span class="string">&quot;order by a.id&quot;</span>)</span><br><span class="line">        .fetch()</span><br><span class="line">        .all()</span><br><span class="line">        .bufferUntilChanged(rowMap -&gt; Long.parseLong(rowMap.get(<span class="string">&quot;aid&quot;</span>).toString()))</span><br><span class="line">        .map(list -&gt; &#123;</span><br><span class="line">            <span class="type">TAuthor</span> <span class="variable">tAuthor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TAuthor</span>();</span><br><span class="line">            Map&lt;String, Object&gt; map = list.get(<span class="number">0</span>);</span><br><span class="line">            tAuthor.setId(Long.parseLong(map.get(<span class="string">&quot;aid&quot;</span>).toString()));</span><br><span class="line">            tAuthor.setName(map.get(<span class="string">&quot;name&quot;</span>).toString());、</span><br><span class="line"></span><br><span class="line">            <span class="comment">//查到的所有图书</span></span><br><span class="line">            List&lt;TBook&gt; tBooks = list.stream()</span><br><span class="line">                    .map(ele -&gt; &#123;</span><br><span class="line">                        <span class="type">TBook</span> <span class="variable">tBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TBook</span>();</span><br><span class="line"></span><br><span class="line">                        tBook.setId(Long.parseLong(ele.get(<span class="string">&quot;id&quot;</span>).toString()));</span><br><span class="line">                        tBook.setAuthorId(Long.parseLong(ele.get(<span class="string">&quot;author_id&quot;</span>).toString()));</span><br><span class="line">                        tBook.setTitle(ele.get(<span class="string">&quot;title&quot;</span>).toString());</span><br><span class="line">                        <span class="keyword">return</span> tBook;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            tAuthor.setBooks(tBooks);</span><br><span class="line">            <span class="keyword">return</span> tAuthor;</span><br><span class="line">        &#125;);<span class="comment">//Long 数字缓存 -127 - 127；// 对象比较需要自己写好equals方法</span></span><br><span class="line">flux.subscribe(tAuthor -&gt; System.out.println(<span class="string">&quot;tAuthor = &quot;</span> + tAuthor));</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="第十七节Spring-Security-Reactive"><a href="#第十七节Spring-Security-Reactive" class="headerlink" title="第十七节	Spring Security Reactive"></a>第十七节	Spring Security Reactive</h2><h3 id="17-1Spring-Security-Reactive简介"><a href="#17-1Spring-Security-Reactive简介" class="headerlink" title="17.1	Spring Security Reactive简介"></a>17.1	Spring Security Reactive简介</h3><ul>
<li><p><strong>应用安全</strong></p>
<ul>
<li>网络攻击：DDos、CSRF、XSS、SQL注入</li>
<li>控制权限<ul>
<li>登录的用户能干什么</li>
<li>用户登录系统以后要控制住用户的所有行为，防止越权</li>
</ul>
</li>
<li>传输加密：https，X509</li>
<li>认证：OAuth2.0，JWT</li>
</ul>
</li>
<li><p><strong>RBAC权限模型</strong>： 基于角色的访问控制</p>
<ul>
<li>一个网站有很多用户</li>
<li>每个用户可以有很多角色</li>
<li>一个角色可以关联很多权限</li>
</ul>
</li>
</ul>
<h3 id="17-2Spring-Security-Reactive开发"><a href="#17-2Spring-Security-Reactive开发" class="headerlink" title="17.2	Spring Security Reactive开发"></a>17.2	Spring Security Reactive开发</h3><ul>
<li><p><strong>认证流程</strong></p>
<ul>
<li><p>配置类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableReactiveMethodSecurity</span> <span class="comment">//开启响应式的基于方法级别的权限控制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppSecurityConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ReactiveUserDetailsService appReactiveUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SecurityWebFilterChain <span class="title function_">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line">        <span class="comment">//1、定义哪些请求需要认证，哪些不需要</span></span><br><span class="line">        http.authorizeExchange(authorize -&gt; &#123;</span><br><span class="line">            <span class="comment">//1.1、允许所有人都访问静态资源；</span></span><br><span class="line">            authorize.matchers(PathRequest.toStaticResources()</span><br><span class="line">                    .atCommonLocations()).permitAll();</span><br><span class="line">            <span class="comment">//1.2、剩下的所有请求都需要认证（登录）</span></span><br><span class="line">            authorize.anyExchange().authenticated();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、开启默认的表单登录</span></span><br><span class="line">        http.formLogin(formLoginSpec -&gt; &#123;</span><br><span class="line"><span class="comment">//            formLoginSpec.loginPage(&quot;/haha&quot;);</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、安全控制:</span></span><br><span class="line">        http.csrf(csrfSpec -&gt; &#123;</span><br><span class="line">            csrfSpec.disable();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、配置 认证规则： 如何去数据库中查询到用户;</span></span><br><span class="line">        http.authenticationManager(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UserDetailsRepositoryReactiveAuthenticationManager</span>(</span><br><span class="line">                        appReactiveUserDetailsService)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建出安全配置</span></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">PasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">        <span class="keyword">return</span> encoder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务层</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// 来定义如何去数据库中按照用户名查用户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppReactiveUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">ReactiveUserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DatabaseClient databaseClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义如何按照用户名去数据库查询用户信息</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PasswordEncoder passwordEncoder;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;UserDetails&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">//从数据库查询用户、角色、权限所有数据的逻辑</span></span><br><span class="line">        Mono&lt;UserDetails&gt; userDetailsMono = databaseClient.sql(<span class="string">&quot;select u.*,r.id rid,r.name,r.value,pm.id pid,pm.value pvalue,pm.description &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;from t_user u &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;left join t_user_role ur on ur.user_id=u.id &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;left join t_roles r on r.id = ur.role_id &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;left join t_role_perm rp on rp.role_id=r.id &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;left join t_perm pm on rp.perm_id=pm.id &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;where u.username = ? limit 1&quot;</span>)</span><br><span class="line">                .bind(<span class="number">0</span>, username)</span><br><span class="line">                .fetch()</span><br><span class="line">                .one()<span class="comment">// all()</span></span><br><span class="line">                .map(map -&gt; &#123;</span><br><span class="line">                    <span class="type">UserDetails</span> <span class="variable">details</span> <span class="operator">=</span> User.builder()</span><br><span class="line">                            .username(username)</span><br><span class="line">                            .password(map.get(<span class="string">&quot;password&quot;</span>).toString())</span><br><span class="line">                            <span class="comment">//自动调用密码加密器把前端传来的明文 encode</span></span><br><span class="line"><span class="comment">//                            .passwordEncoder(str-&gt; passwordEncoder.encode(str)) //为啥？？？</span></span><br><span class="line">                            <span class="comment">//权限</span></span><br><span class="line"><span class="comment">//                            .authorities(new SimpleGrantedAuthority(&quot;ROLE_delete&quot;)) //默认不成功</span></span><br><span class="line">                            .roles(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;sale&quot;</span>,<span class="string">&quot;haha&quot;</span>,<span class="string">&quot;delete&quot;</span>) <span class="comment">//ROLE成功</span></span><br><span class="line">                            .build();</span><br><span class="line">                    <span class="comment">//角色和权限都被封装成 SimpleGrantedAuthority</span></span><br><span class="line">                    <span class="comment">// 角色有 ROLE_ 前缀， 权限没有</span></span><br><span class="line">                    <span class="comment">// hasRole：hasAuthority</span></span><br><span class="line">                    <span class="keyword">return</span> details;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">return</span> userDetailsMono;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>授权</strong></p>
<ul>
<li><p>控制层</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;admin&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//复杂的SpEL表达式</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;delete&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/world&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">world</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;world!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableReactiveMethodSecurity</span> <span class="comment">//开启响应式 的 基于方法级别的权限控制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppSecurityConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ReactiveUserDetailsService appReactiveUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SecurityWebFilterChain <span class="title function_">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line">        <span class="comment">//1、定义哪些请求需要认证，哪些不需要</span></span><br><span class="line">        http.authorizeExchange(authorize -&gt; &#123;</span><br><span class="line">            <span class="comment">//1.1、允许所有人都访问静态资源；</span></span><br><span class="line">            authorize.matchers(PathRequest.toStaticResources()</span><br><span class="line">                    .atCommonLocations()).permitAll();</span><br><span class="line">            <span class="comment">//1.2、剩下的所有请求都需要认证（登录）</span></span><br><span class="line">            authorize.anyExchange().authenticated();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、开启默认的表单登录</span></span><br><span class="line">        http.formLogin(formLoginSpec -&gt; &#123;</span><br><span class="line"><span class="comment">//            formLoginSpec.loginPage(&quot;/haha&quot;);</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、安全控制:</span></span><br><span class="line">        http.csrf(csrfSpec -&gt; &#123;</span><br><span class="line">            csrfSpec.disable();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、配置 认证规则： 如何去数据库中查询到用户;</span></span><br><span class="line">        http.authenticationManager(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UserDetailsRepositoryReactiveAuthenticationManager</span>(</span><br><span class="line">                        appReactiveUserDetailsService)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//构建出安全配置</span></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">PasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">        <span class="keyword">return</span> encoder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">huzzsea</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/07/24/SpringBoot/">http://example.com/2024/07/24/SpringBoot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">huzzsea</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/26/RabbitMQ/" title="RabbitMQ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RabbitMQ</div></div></a></div><div class="next-post pull-right"><a href="/2024/06/11/Shell/" title="Shell"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Shell</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">huzzsea</div><div class="author-info__description">心有所向，无问东西</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%8A%82SpringBoot%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">第一节	SpringBoot快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1	简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2	快速体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3	应用分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4%E6%A0%B8%E5%BF%83%E6%8A%80%E8%83%BD"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4	核心技能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82SpringBoot-Web%E5%BC%80%E5%8F%91"><span class="toc-number">1.2.</span> <span class="toc-text">第二节	SpringBoot-Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1WebMvcAutoConfiguration%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1	WebMvcAutoConfiguration原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2Web%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2	Web场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3	静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4	路径匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5	内容协商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6	模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">1.2.7.</span> <span class="toc-text">2.7	国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.2.8.</span> <span class="toc-text">2.8	错误处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="toc-number">1.2.9.</span> <span class="toc-text">2.9	嵌入式容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1SpringMVC"><span class="toc-number">1.2.10.</span> <span class="toc-text">2.10	全面接管SpringMVC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11Web%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.11.</span> <span class="toc-text">2.11	Web新特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%8A%82SpringBoot%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-number">1.3.</span> <span class="toc-text">第三节	SpringBoot数据访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E8%8A%82SpringBoot%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">第四节	SpringBoot基础特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1SpringApplication"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1	SpringApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2Profiles"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2	Profiles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3	外部化配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95JUnit5"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4	单元测试JUnit5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E8%8A%82SpringBoot%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">第五节	SpringBoot核心原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E4%BA%8B%E4%BB%B6%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1	事件和监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2	自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3	自定义starter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4SpringBoot3%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4	SpringBoot3新特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E8%8A%82NoSQL"><span class="toc-number">1.6.</span> <span class="toc-text">第六节	NoSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1Redis%E6%95%B4%E5%90%88"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1	Redis整合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E8%8A%82%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">1.7.</span> <span class="toc-text">第七节	接口文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1Swagger"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1	Swagger</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E8%8A%82%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">第八节	远程调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1	远程调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2WebClient"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2	WebClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3HTTP-Interface"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3	HTTP Interface</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E8%8A%82%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.9.</span> <span class="toc-text">第九节	消息服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1	消息队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2Kafka"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2	Kafka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E8%8A%82Web%E5%AE%89%E5%85%A8"><span class="toc-number">1.10.</span> <span class="toc-text">第十节	Web安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.10.1.</span> <span class="toc-text">10.1	安全架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2Spring-Security-%E5%8E%9F%E7%90%86"><span class="toc-number">1.10.2.</span> <span class="toc-text">10.2	Spring Security 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.3.</span> <span class="toc-text">10.3	使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4%E5%AE%9E%E6%88%98"><span class="toc-number">1.10.4.</span> <span class="toc-text">10.4	实战</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E8%8A%82%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7"><span class="toc-number">1.11.</span> <span class="toc-text">第十一节	可观测性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1SpringBoot-Actuator"><span class="toc-number">1.11.1.</span> <span class="toc-text">11.1	SpringBoot Actuator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2%E7%9B%91%E6%8E%A7%E6%A1%88%E4%BE%8B"><span class="toc-number">1.11.2.</span> <span class="toc-text">11.2	监控案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E8%8A%82AOT"><span class="toc-number">1.12.</span> <span class="toc-text">第十二节	AOT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1AOT%E4%B8%8EJIT"><span class="toc-number">1.12.1.</span> <span class="toc-text">12.1	AOT与JIT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2GraalVM"><span class="toc-number">1.12.2.</span> <span class="toc-text">12.2	GraalVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3SpringBoot%E6%95%B4%E5%90%88"><span class="toc-number">1.12.3.</span> <span class="toc-text">12.3	SpringBoot整合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82Java%E5%93%8D%E5%BA%94%E5%BC%8F%E6%B5%81"><span class="toc-number">1.13.</span> <span class="toc-text">第十三节	Java响应式流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.13.1.</span> <span class="toc-text">13.1	Lambda表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.2.</span> <span class="toc-text">13.2	函数式接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3StreamAPI"><span class="toc-number">1.13.3.</span> <span class="toc-text">13.3	StreamAPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4Reactive-Stream"><span class="toc-number">1.13.4.</span> <span class="toc-text">13.4	Reactive-Stream</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82Reactor%E6%A0%B8%E5%BF%83"><span class="toc-number">1.14.</span> <span class="toc-text">第十四节	Reactor核心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1Reactor%E7%AE%80%E4%BB%8B"><span class="toc-number">1.14.1.</span> <span class="toc-text">14.1	Reactor简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">1.14.2.</span> <span class="toc-text">14.2	响应式编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">1.14.3.</span> <span class="toc-text">14.3	核心特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4Sinks%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.14.4.</span> <span class="toc-text">14.4	Sinks工具类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E8%8A%82Spring-Webflux"><span class="toc-number">1.15.</span> <span class="toc-text">第十五节	Spring Webflux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1WebFlux%E7%AE%80%E4%BB%8B"><span class="toc-number">1.15.1.</span> <span class="toc-text">15.1	WebFlux简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2WebFlux%E6%A0%B8%E5%BF%83"><span class="toc-number">1.15.2.</span> <span class="toc-text">15.2	WebFlux核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-3WebFlux%E5%BC%80%E5%8F%91"><span class="toc-number">1.15.3.</span> <span class="toc-text">15.3	WebFlux开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E8%8A%82R2DBC"><span class="toc-number">1.16.</span> <span class="toc-text">第十六节	R2DBC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#16-1R2DBC%E7%AE%80%E4%BB%8B"><span class="toc-number">1.16.1.</span> <span class="toc-text">16.1	R2DBC简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-2Spring-Data-R2DBC"><span class="toc-number">1.16.2.</span> <span class="toc-text">16.2	Spring Data R2DBC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-3RBAC-SOL"><span class="toc-number">1.16.3.</span> <span class="toc-text">16.3	RBAC-SOL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E8%8A%82Spring-Security-Reactive"><span class="toc-number">1.17.</span> <span class="toc-text">第十七节	Spring Security Reactive</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#17-1Spring-Security-Reactive%E7%AE%80%E4%BB%8B"><span class="toc-number">1.17.1.</span> <span class="toc-text">17.1	Spring Security Reactive简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-2Spring-Security-Reactive%E5%BC%80%E5%8F%91"><span class="toc-number">1.17.2.</span> <span class="toc-text">17.2	Spring Security Reactive开发</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/26/RabbitMQ/" title="RabbitMQ">RabbitMQ</a><time datetime="2024-07-26T15:32:51.000Z" title="发表于 2024-07-26 23:32:51">2024-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/24/SpringBoot/" title="SpringBoot">SpringBoot</a><time datetime="2024-07-23T16:29:47.000Z" title="发表于 2024-07-24 00:29:47">2024-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/11/Shell/" title="Shell">Shell</a><time datetime="2024-06-11T13:27:53.000Z" title="发表于 2024-06-11 21:27:53">2024-06-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/06/Redis/" title="Redis">Redis</a><time datetime="2024-06-05T16:31:51.000Z" title="发表于 2024-06-06 00:31:51">2024-06-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/29/Python/" title="Python">Python</a><time datetime="2024-01-28T16:00:11.000Z" title="发表于 2024-01-29 00:00:11">2024-01-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By huzzsea</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>